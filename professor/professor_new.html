<!DOCTYPE html>
<head>
	<title>I Am (Still) Here!</title>
	<link rel="icon" type="image/png" href="/img/favicon.png"/>
</head>

<link rel="stylesheet" type="text/css" href="/style.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3pro.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata">
<script src="https://www.w3schools.com/lib/w3.js"></script>

<!-- Top banner -->
<ul class="navbar">
	<li class="item-left" style="padding-top: 0"><a href="/professor/courses" class="name monserrat-black">I AM (STILL) HERE!</a></li>
	<li class="item-left" style="padding-top: 3px"><span class="name roboto-light" id="IST_NAME"></span></li>

	<li class="item-right"><a href="/logout" class="btn-white"><img src="/img/logout.svg" class="img-button"> Log Out</a></li>
	<li class="item-right" id="admin" style="display: none"><a href="/admin" class="btn-white" style="margin-right: 10px"><img src="/img/admin.svg" class="img-button"> Administration</a></li>
	<li class="item-right"><a onclick="return showLink(this, event)" id="tsv_export_by_secret" class="btn-white" style="margin-right:10px" title="Permanent link to all attendances for this course"><img src="/img/link.svg" class="img-button"> Permanent Link</a></li>
	<li class="item-right"><a onclick="goTo('/professor/studentslist?c='+courseID)" class="btn-white" style="margin-right:10px" ><img src="/img/group.svg" class="img-button"> Students</a></li>
	<!--<li class="item-right" id="btn-indWeights" style="display: none;"><a class='btn-white' onclick="getFixedWeight()" title="Configure indicator weights" style="margin-right:10px"><span><img src="/img/settings.svg" class="img-button" alt="Configure weight"> Configure indicator weights </span></a></li>-->
	<!--<li class="item-right dropdown-nav" id="btn-config" style="display: none">
		<a href="javascript:void(0)" class="dropbtn-nav btn-white" style="border:none;margin-right:10px">
			<img src="/img/settings.svg" class="img-button" alt="Configure weight">
			Configurations
		</a>
		<div class="dropdown-content-nav">
			<a onclick="getFixedWeight()" title="Configure indicator weights" id="btn-indWeights">
				<span style="color:black; font-size: 14px">
					Indicator Weight
				</span>
			</a>
			<a onclick="configStudentStatus()" title="Configure students status" id="btn-stStatus">
				<span style="color:black; font-size: 14px">
					Student Status
				</span>
			</a>
			<a onclick="displayEditConfidence()" title="Configure final confidence" id="btn-confWeight">
				<span style="color:black; font-size: 14px">
					Final Confidence
				</span>
			</a>
		</div>
	</li>-->
</ul>
<!-- Top banner -->

<!-- Shift's table -->
<div class="container inlineblock" id="showShifts">

	<div class="menu-container">
		<div class="menu-item item-left menu-button">
			<a href="/professor/classes" class="previous round">&#8249;</a>
		</div>

		<div class="menu-item item-left menu-title" id="courseName_id"></div>
	</div>

	<div id="invisible-info-shifts" style="display:none; ">
		<p>Currently, you do not have shifts. Add one yourself <span id="fenixCourseSpan" style="display:none;">or load now from fénix</span>!</p>
		<!--<button onclick="loadShifts()" type="button">Load shift(s) from Fénix</button>-->
	</div>

	<p id="prof_title" style="display: none" class="subTitle on">Professor(s) lecturing:</p>
	<div id="shiftOn" class="">
		<p class="subTitle">Shifts</p>
		Type:
		<label for="shift_select"></label>
		<select id="shift_select" onchange="changeShift(this)">
			<template id="shiftOnTemplate">
				<option></option>
				<option></option>
				<option></option>
				<option></option>
				<option></option>
			</template>
		</select>
	</div>


	<table id="shifttable_main" class="hide table-margin">
		<tbody id="shiftTable">
		<tr style="cursor: not-allowed">
			<th rowspan="2">Shift ID</th>
			<th rowspan="2">Campus</th>
			<th colspan="3">Schedule</th>
			<th rowspan="2">Room</th>
			<th rowspan="2">Professor</th>
			<th colspan="4">Code</th>
			<th rowspan="2">Type</th>
		</tr>
		<tr style="cursor: not-allowed">
			<th>Day</th>
			<th>Start</th>
			<th>End</th>
			<th>Type</th>
			<th>Length</th>
			<th>Consecutive</th>
			<th>Time</th>
		</tr>

		<template id="shiftTemplate">
			<!--<tr class="clickable_different myeditable" style="text-align: center">-->
			<tr style="text-align: center" class="clickable">
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td title="Edit Shift" >
					<button onclick="enterShift(this.closest('tr'))"><img src="/img/lupa.svg" class="img-button"></button>
					<button onclick="editShift(this.closest('tr'))"><img src="/img/pencil.svg" class="img-button"></button>
					<button onclick="manuallyRemoveShift(this.closest('tr').children[0].innerHTML)"><img src="/img/delete.svg" class="img-button"></button>
				</td>
			</tr>
		</template>

		<!--<form id="updateShift" style="display: none">
            <tr id="updateShift_tr" >
                <td>
                    <input type="hidden" name="shift_uid">
                    <input type="text" name="shift_id" placeholder="AP34T01" required> </td>
                <td>
                    <select name="campus" required>
                        <option value="Alameda">Alameda</option>
                        <option value="Taguspark">Taguspark</option>
                    </select>
                </td>
                <td>
                    <select name="week_day" required>
                        <option value="1">Mon</option>
                        <option value="2">Tue</option>
                        <option value="3">Wed</option>
                        <option value="4">Thu</option>
                        <option value="5">Fri</option>
                        <option value="6">Sat</option>
                        <option value="0">Sun</option>
                    </select>
                </td>
                <td><input type="time" name="start" required></td>
                <td><input type="time" name="end" required></td>
                <td><input type="text" name="room" placeholder="FA2" required></td>
                <td><select id="professor_select_all_1" name="professor_id">
                </select>
                </td>
                <td><select name="code_type" required>
                    <option value="L" selected="selected">L</option>
                    <option value="N">N</option>
                    <option value="LN">L + N</option>
                </select></td>
                <td><select name="code_length" required>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6" selected="selected">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                </select></td>
                <td><select name="consecutivecodes" required>
                    <option value="2">2</option>
                    <option value="3" selected="selected">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                </select></td>
                <td><select name="time" required>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10" selected="selected">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select></td>
                <td>
                    <select name="type" required>
                        <option value="Teórica">Teórica</option>
                        <option value="Laboratorial">Laboratorial</option>
                        <option value="Seminário">Seminário</option>
                        <option value="Prática">Prática</option>
                    </select>
                </td>
                <td>
                    <button type="button" onclick="updateShift(this)">Update</button>
                    <button type="button" onclick="manuallyRemoveShift(this)">Remove</button>
                    <button type="button" onclick="toggleShowNewShift()">Cancel</button>
                </td>
            </tr>
        </form>-->

		<form id="insertShift">
			<tr id="insertShift_tr" style="display: none" required>
				<td><input type="text" name="shift_id" placeholder="AP34T01" required> </td>
				<td>
					<select name="campus" required>
						<option value="Alameda">Alameda</option>
						<option value="Taguspark">Taguspark</option>
					</select>
				</td>
				<td>
					<select name="week_day" required>
						<option value="1">Mon</option>
						<option value="2">Tue</option>
						<option value="3">Wed</option>
						<option value="4">Thu</option>
						<option value="5">Fri</option>
						<option value="6">Sat</option>
						<option value="0">Sun</option>
					</select>
				</td>
				<td><input type="time" name="start" required></td>
				<td><input type="time" name="end" required></td>
				<td><input type="text" name="room" placeholder="FA2"></td>
				<td>
					<select id="professor_select_all" name="professor_id"></select>
				</td>
				<td><select name="code_type" required>
					<option value="L" selected="selected">L</option>
					<option value="N">N</option>
					<option value="LN">L + N</option>
				</select></td>
				<td><select name="code_length" required>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6" selected="selected">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
				</select></td>
				<td><select name="consecutivecodes" required>
					<option value="2">2</option>
					<option value="3" selected="selected">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
				</select></td>
				<td><select name="time" required>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10" selected="selected">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
				</select></td>
				<td><select name="type" required>
					<option value="Teórica">Teórica</option>
					<option value="Laboratorial">Laboratorial</option>
					<option value="Seminário">Seminário</option>
					<option value="Prática">Prática</option>
				</select></td>
				<td>
					<button id="create_add_shift" onclick="insertShiftForm(this)" type="button">Add</button>
					<button id="toggle_button" onclick="removeNewShift()" type="button">Cancel</button>
				</td>
			</tr>
		</form>
		</tbody>
	</table>

	<p></p>
	<div class="item-right">
		<a class='btn-blue' href="#" id="add_shift"
		   onclick="addNewShift(this);"
		   title="Create course">
			<span><img src="/img/add.svg" class="img-button"> Add Shift</span>
		</a>
	</div>

	<div class="item-right">
		<a class='btn-blue' href="#" id="fenixCourse" style="margin-right: 5px; display:none;"
		   onclick="loadShifts()"
		   title="Create course from Fenix">
			<span><img src="/img/add.svg" class="img-button"> Load shift(s) from Fénix </span>
		</a>
	</div>

	<!-- Professors table -->
	<p class="subTitle" style="margin-top: 50px">Professors</p>
	<table id="professors" class="table-margin">
		<tbody id="professorstable">
		<tr id="professors_tr">
			<th>ID</th>
			<th>Name</th>
		</tr>

		</tbody>
	</table>
	<div style="float: right; margin-right: 225px; margin-top: 10px">
		<a class='btn-blue' href="#" id="add_professor"
		   onclick="document.getElementById('insertProfessor').style.display=''; this.style.display='none'"
		   title="Create course">
			<span><img src="/img/add.svg" class="img-button"> Add Professor</span>
		</a>
	</div>
	<form id="insertProfessor" style="display:none; margin-left: 225px;">
		<tr id="insertProfessor_tr">
			<td>ID: <input type="text" name="ist_id" placeholder="ist187664" required> </td>
			<td style="text-align:right;">
				<button type="button" onclick="insertProfessorIntoCourse()" class="btn-grey">Add</button>
			</td>
			<td style="text-align:center;">
				<button type="button" onclick="document.getElementById('add_professor').style.display='';document.getElementById('insertProfessor').style.display='none';" class="btn-grey">Cancel</button>
			</td>
		</tr>
	</form>
	<!-- Professors table end -->

</div>



<!-- Class's table -->
<div class="container inlineblock" id="showHistoryofProfessor" style="display: none">
	<!-- back button -->
	<div class="menu-container">
		<div class="menu-item item-left menu-button">
			<a onclick="switchView(-1)" class="previous round">&#8249;</a>
		</div>

		<div class="menu-item item-left menu-title" id="courseName_id2">
		</div>

		<div class="menu-item item-right menu-button">
			<a class="previous round">
			</a>
		</div>
		<div class="item-right menu-item">
			<a class='btn-blue' href="#" id="b_attendance"
			   onclick="goTo('/professor/attendance?c='+courseID+'&s='+currentShift)"
			   title="Generate a new sequence">
				<span><img src="/img/add.svg" class="img-button"> Add Class</span>
			</a>
		</div>
	</div>

	<!-- Class number and title -->
	<div>
		<h6 id="noAttendancesText" style="display:none">
			You do not have an attendance for this course. Start one now!
		</h6>

		<div style="display:none" class="topalert" id="warningalert">
			<span class="bold">Warning: </span>
			<span>This is not your usual shift!</span>
		</div>

		<div id="teacherOn" class="">
			<p class="subTitle" id="attendancesTitle"><span id="currentShift_display"></span> (<span id="currentCampus_display"></span>) <span class="roboto-regular"> Classes</span></p>
			Professor:
			<select id="professor_select" onchange="changeProfessor(this)">
				<template id="teacherOnTemplate">
					<option></option>
				</template>
			</select>
		</div>

		<div id="importAttendanceDiv" style="display:none">

			<p>Format: <span class="mono">student_number, type of attendance (ok or late)</span><p>
			<form id="importAttendanceID" method="post">
				<table class="invisible-table" style="margin-bottom: 4px">
					<tr>
						<td >Example (on time):</td>
						<td class="mono">ist182083,ok</td>
					</tr>
					<tr>
						<td>Example (late):</td>
						<td class="mono">ist182083,late</td>
					</tr>
					<tr>
						<td>
							Professor:
						</td>
						<td>
							<input id="professor_number" name="professor_number" pattern="^ist\d\d\d\d\d\d$" type="text" placeholder="istXXXXXX"></input>
						</td>
					</tr>
					<tr>
						<td>
							Shift:
						</td>
						<td>
							<input id="importattendance_shift" name="shift" type="text"></input>
						</td>
					</tr>
					<tr>
						<td>
							Class number:
						</td>
						<td>
							<input id="class_number" name="class_number" type="number"></input>
						</td>
					</tr>

					<tr>
						<td>
							Title:
						</td>
						<td>
							<input id="" name="mytitle" type="text" placeholder="(optional)"></input>
						</td>
					</tr>

					<tr title="Invited lecture or extraordinary class">
						<td></td>
						<td>
							<input type="checkbox" id="addIsExtra" name="is_extra" value="is_extra"> Extra Class
						</td>
					</tr>

					<tr>
						<td colspan="2">
							<textarea oninput="verifyTextArea()" name="file_input" id="myFile_attendances" class="textarea_input"></textarea>
						</td>
					</tr>

				</table>

				<button type="button" id="sendImportAttendance" onclick="sendFileAsForm();" disable>Import</button>
				<button type="button" onclick="cancelImport()">Cancel</button>

			</form>
		</div>


		<!-- Class's table -->
		<table id="historyTable" class="table-margin">
			<tr style="cursor: not-allowed;">
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(1)')">Class #</th>
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(2)')">Title</th>
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(3)')">Date</th>
				<th colspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(4)')">Code</th>
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(6)')">Time</th>
				<th rowspan="2" title="Consecutive Codes" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(7)')">Codes</th>
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(8)')">Students</th>
				<th>Extra class</th>
				<th>Remote</th>
				<th rowspan="2" class="th-sortable" onclick="w3.sortHTML('#historyTable', '.clickable', 'td:nth-child(8)')">Attendances</th>
			</tr>
			<tr style="cursor: not-allowed;">
				<th>Type</th>
				<th>Length</th>
			</tr>

			<template id="historyTemplate">
				<tr class="clickable">
					<td class="classCounter"></td>
					<td class="classnumber"></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td></td>
					<td class="classattendances"></td>
					<td title="Edit class">
						<button onclick="enterClass(this.closest('tr'))"><img src="/img/lupa.svg" class="img-button"></button>
						<!--<button onclick="return manuallyRemoveAttendance(this, event)"><img src="/img/delete.svg" class="img-button"></button>-->
						<button onclick="manuallyUpdateClass(this, this.closest('tr'))"><img src="/img/pencil.svg" class="img-button"></button>
						<button onclick="updateClass(this.closest('tr').children[0].innerText, true, null, null, event)"><img src="/img/delete.svg" class="img-button"></button>

					</td>
				</tr>
			</template>
		</table>
		<p id="historyTable_error"></p>
	</div>
</div>
<!-- Class's table end -->


<!-- Students's table -->
<div>
	<div id="configWeightDiv" class="center hidden">
		<form id="updateFixedWeight">
			<table class="center">
				<tr>
					<td style="width: 200px; text-align: center"><label for="useragent" style="padding: 5px;">Useragent <br>
						<input id="useragent" name="useragent" type="range" min="0" max="5" value="2">
					</label></td>
					<td style="width: 200px; text-align: center"><label for="ip" style="padding: 5px;">IP<br>
						<input id="ip" name="ip" type="range" min="0" max="5" value="3">
					</label></td>
					<td style="width: 200px; text-align: center"><label for="languages" style="padding: 5px;">Language<br>
						<input id="languages" name="languages" type="range" min="0" max="5" value="2">
					</label></td>
				</tr>

				<tr>
					<td style="text-align: center"><label for="colorDepth" style="padding: 5px;">Color Depth<br>
						<input id="colorDepth" name="colorDepth" type="range" min="0" max="5" value="4">
					</label></td>

					<td style="text-align: center"><label for="deviceMemory" style="padding: 5px;">Device Memory<br>
						<input id="deviceMemory" name="deviceMemory" type="range" min="0" max="5" value="4">
					</label></td>
					<td style="text-align: center"><label for="hardwareConcurrency" style="padding: 5px;">Hardware Concurrency<br>
						<input id="hardwareConcurrency" name="hardwareConcurrency" type="range" min="0" max="5" value="4">
					</label></td>
				</tr>

				<tr>
					<td style="text-align: center"><label for="screenResolution" style="padding: 5px;">Screen Resolution<br>
						<input id="screenResolution" name="screenResolution" type="range" min="0" max="5" value="2">
					</label></td>
					<td style="text-align: center"><label for="availableScreenResolution" style="padding: 5px;">Available Screen Resolution<br>
						<input id="availableScreenResolution" name="availableScreenResolution" type="range" min="0" max="5" value="2">
					</label></td>
					<td style="text-align: center"><label for="sessionStorage" style="padding: 5px;">Session Storage<br>
						<input id="sessionStorage" name="sessionStorage" type="range" min="0" max="5" value="1">
					</label></td>
				</tr>

				<tr>
					<td style="text-align: center"><label for="localStorage" style="padding: 5px;">Local Storage<br>
						<input id="localStorage" name="localStorage" type="range" min="0" max="5" value="1">
					</label></td>
					<td style="text-align: center"><label for="platform" style="padding: 5px;">Platform<br>
						<input id="platform" name="platform" type="range" min="0" max="5" value="3">
					</label></td>
					<td style="text-align: center"><label for="plugins" style="padding: 5px;">Plugins<br>
						<input id="plugins" name="plugins" type="range" min="0" max="5" value="1">
					</label></td>
				</tr>

				<tr>
					<td style="text-align: center"><label for="fonts" style="padding: 5px;">Fonts<br>
						<input id="fonts" name="fonts" type="range" min="0" max="5" value="3">
					</label></td>
					<td style="text-align: center"><label for="audio" style="padding: 5px;">Audio<br>
						<input id="audio" name="audio" type="range" min="0" max="5" value="4">
					</label></td>
					<td style="text-align: center"><label for="gpu" style="padding: 5px;">GPU<br>
						<input id="gpu" name="gpu" type="range" min="0" max="5" value="5">
					</label></td>
				</tr>

				<tr>
					<td style="text-align: center"><label for="adBlock" style="padding: 5px;">AdBlock<br>
						<input id="adBlock" name="adBlock" type="range" min="0" max="5" value="4">
					</label></td>
					<td style="text-align: center"><label for="pixelDepth" style="padding: 5px;" >Color Resolution<br>
						<input id="pixelDepth" name="pixelDepth" type="range" min="0" max="5" value="4">
					</label></td>
				</tr>
				<tr>
					<td  style="text-align: center" colspan="3">Change for:
						<input type="radio" id="class" name="type_update" value="class" checked>
						<label for="class"> For this class</label>
						<input type="radio" id="class_and_future" name="type_update" value="class_and_future">
						<label for="class_and_future"> For this and further classes</label>
						<input type="radio" id="all_class" name="type_update" value="all_class">
						<label for="all_class"> For all classes</label>
					</td>
				</tr>
				<tr style="background-color: white">
					<td colspan="3" style="text-align: center">
						<button onclick="updateFixedWeights()" type="button" class="btn-grey-blue">Update</button>
						<button onclick="defaultFixedWeights()" type="button" class="btn-grey-light-blue">Default</button>
						<button onclick="cancelFixedWeight()" type="button" class="btn-grey">Cancel</button>
					</td>
				</tr>
			</table>
		</form>
	</div>

	<div id="editThreshDiv" class="center hidden">
		<form id="updateThresh">
			<table class="center">
				<tr>
					<td style="width: 200px; text-align: center"><label for="fail_thresh" style="padding: 5px;"> <img src="/img/square_failed.svg" style="width: 10px"> Fingerprint Fail
						<input id="fail_thresh" name="fail_thresh" type="range" min="0" max="100" value="81" oninput="this.nextElementSibling.value = this.value/100">
						<output>0.81</output>
					</label></td>
					<td style="width: 200px; text-align: center"><label for="ok_thresh" style="padding: 5px;"><img src="/img/square_ok.svg" style="width: 10px"> Fingerprint OK
						<input id="ok_thresh" name="ok_thresh" type="range" min="0" max="100" value="90" oninput="this.nextElementSibling.value = this.value/100">
						<output>0.90</output>
					</label></td>
				</tr>

				<tr>
					<td  style="text-align: center" colspan="3">Apply for:
						<input type="radio" id="apply_course" name="type_update" value="apply_course" checked>
						<label for="apply_course">All classes from this course</label>
						<input type="radio" id="apply_shift" name="type_update" value="apply_shift">
						<label for="apply_shift"> All classes from this shift</label>
						<input type="radio" id="apply_class" name="type_update" value="apply_class">
						<label for="apply_class"> For this class</label>
					</td>
				</tr>
				<tr style="background-color: white">
					<td colspan="3" style="text-align: center">
						<button onclick="updateFixedThresh()" type="button" class="btn-grey-blue">Update</button>
						<button onclick="defaultFixedThresh()" type="button" class="btn-grey-light-blue">Default</button>
						<button onclick="cancelFixedThresh()" type="button" class="btn-grey">Cancel</button>
					</td>
				</tr>
			</table>
		</form>
	</div>

	<div id="showStudentsHistory-aux" style="position: absolute; top:90px; right: 10px; z-index: 999">

		<div id="btn-config" class="dropdown-nav" style="display: none; float: right">
			<a href="javascript:void(0)" class="btn-blue" id="conf" style="background-color: #fff; color:#000">
				<img src="/img/settings.svg" class="img-button" alt="Configure weight">
				Configurations
			</a>
			<div class="dropdown-content-nav">
				<a onclick="getFixedWeight()" title="Configure indicator weights" id="btn-indWeights">
						<span style="color:black; font-size: 14px;">
							Indicator Weight
						</span>
				</a>
				<a onclick="configStudentStatus()" title="Configure students status" id="btn-stStatus">
						<span style="color:black; font-size: 14px">
							Student Status
						</span>
				</a>
				<a onclick="displayEditConfidence()" title="Configure final confidence" id="btn-confWeight">
						<span style="color:black; font-size: 14px">
							Confidence
						</span>
				</a>

				<a onclick="displayEditThresh()" title="Configure threshold to accept fingerprint" id="btn-confThresh">
						<span style="color:black; font-size: 14px">
							Fingerprint Threshold
						</span>
				</a>
			</div>
		</div>

		<div  style="float: right; display:none; padding-right:5px" id="btn-create-att">
			<a class='btn-blue'
			   onclick="goTo1('/professor/attendance?c='+courseID+'&s='+currentShift)"
			   title="Generate a new sequence">
				<span><img src="/img/add.svg" class="img-button" alt="Create new attendance"> New attendance check</span>
			</a>
		</div>
	</div>

	<div class="container inlineblock" id="showStudentsHistory" style="display: none">
		<div class="menu-container">
			<div class="menu-item item-left menu-button">
				<!--<a onclick="switchView(0);cancelAction();loadHistory(courseID,null,currentShift,currentCampus)"	class="previous round">&#8249;</a>-->
				<a onclick="switchView(0);cancelAction();loadHistory(courseID,null,currentShift,currentCampus)"	class="previous round">&#8249;</a>
			</div>

			<!-- Not editing mode -->
			<div id="classInfo">
				<div class="menu-item item-left menu-title" id="currentClassDiv">
					Class <span style="font-weight: bold">#<span id="currentClass"></span></span>
				</div>

				<div class="menu-item item-left item-left-second menu-title" id="currentTitleDiv">
					<span id="currentTitle"></span>
				</div>
			</div>


			<div>
				<!-- TODO -->
				<!-- Editing mode -->
				<div id="editClassInfo" style="display:none">
					<form id="editClassInfoForm" method="post">
						<table class="invisible-table" style="margin-bottom: 4px">
							<tr>
								<td>
									Class number:
								</td>
								<td>
									<label for="addClassCounter"></label><input id="addClassCounter" name="number" type="number"/>
								</td>
							</tr>

							<tr>
								<td>
									Title:
								</td>
								<td>
									<label for="addTitle"></label><input id="addTitle" name="mytitle" type="text"/>
								</td>
							</tr>

							<tr title="Invited lecture or extraordinary class">
								<td></td>
								<td>
									<label for="addIsExtra"></label><input type="checkbox" id="addIsExtra" name="is_extra" value="is_extra"> Extra Class
								</td>
							</tr>
						</table>
						<button type="button" onclick="sendClassInformation()">Save</button>
						<button type="button" onclick="cancelAction(this)">Cancel</button>
					</form>
				</div>
			</div>
		</div>


		<!-- Edit student status -->
		<div id="configStatusDiv" class="center hidden">
			<form id="updateStudentStatus">
				<p>For a student to have a <b>complete</b> their attendance for a class, they</p>
				<p><label for="totalAttendance" style="padding: 5px;">Need to register in <b>total</b>:</label>
					<select name="totalAttendances" id="totalAttendance">
					</select></p>
				<div id="specificAttendance"></div>
				<div id="specificLate"></div>
				<div id="specificEarly"></div>
				<button onclick="updateStudentStatus()" type="button" class="btn-grey">Update</button>
			</form>
		</div>


		<!-- Student's table -->
		<div id ="attendanceDiv" style="visibility: hidden">
			<div style="margin-right: 2px" class="historycolumn" id="historycolumnDiv">

				<table id="studentsTable" class="table-margin">
					<tr>
						<th style="cursor:not-allowed">IST ID</th>
						<th style="cursor:not-allowed">Name</th>
						<th style='cursor:not-allowed'>Complete</th>
						<th style='cursor:not-allowed'>Late</th>
						<th style='cursor:not-allowed'>Left Early</th>
						<th style='cursor:not-allowed'>Middle</th>
						<th style="cursor:not-allowed">Fingerprint</th>
						<th id="att1" style="cursor:not-allowed">Attendance #1</th>
					</tr>

					<template id="studentsTemplate">
						<tr class="clickable">
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td></td>
							<td onmouseover="displayLogos(this)" onmouseout="hideLogos(this)" style="text-align: center"><span  id="fp_gps_logo" style="display:none;"><img src="/img/fingerprint_ok.svg" id="fingerprint" class="img-button"><img src="/img/placeholder.svg" id="gps" class="img-button"></span><img src="/img/square.svg" id="square" class="img-button"></td>
							<td></td>
						</tr>
					</template>
				</table>
			</div>



			<!-- Student's that failed table -->
			<div id="attempedstudentsDiv">
				<p>Students that failed to take the attendance:</p>
				<table id="attempedstudentsTable"  style="display: table; margin-right: auto; margin-left: auto;" >
					<tr>
						<th>IST ID</th>
						<th>Name</th>
						<th>Attendance Failed</th>
					</tr>

					<template id="attempedstudentsTemplate">
						<tr>
							<td></td>
							<td></td>
							<td></td>
							<td><button onclick="copyISTIDToAddStudent(this)">+</button></td>
						</tr>
					</template>
				</table>
			</div>
		</div>

		<p></p>


		<div id="formStudentContainer">
			<div id="informationContainer">
				<div id="informationImgBox">
					<div id="informationTextBox">
						<p><img src="/img/fingerprint_ok.svg" class="img-button"> Fingerprint trustworthy</p>
						<p><img src="/img/fingerprint_maybe.svg" class="img-button"> Fingerprint uncertain</p>
						<p><img src="/img/fingerprint_failed.svg" class="img-button"> Fingerprint untrustworthy</p>

						<p><img src="/img/placeholder.svg" class="img-button"> Location between 1m and 10m.</p>
						<p><img src="/img/placeholder_maybe.svg" class="img-button"> Location between 10m and 1000m.</p>
						<p><img src="/img/placeholder_failed.svg" class="img-button"> Location between 1Km and 10Km.</p>
					</div>
					<img src="/img/information-button.svg" class="img-button" id="infobtn" style="float: right">
				</div>
			</div>


			<form id="formStudent" method="post" style="float: left; background-color: #5B9CC0; padding: 5px 10px 5px 10px; margin-bottom: -15px; margin-left: -15px; border-radius: 0px 15px 0px 0px">
				<label for="inputadd_student"></label><input id="inputadd_student" name="ist_id" placeholder="IST ID (ist1XXXXX)" autocomplete="off" onkeyup="showStudentsNumbers();searchStudentList()">
				<ul id="searchStudentListForm"></ul>

				<label for="attendanceTable">Attendance Check:</label><select id="attendanceTable"></select>
				<span id="late_checkbox_span"><label for="late_checkbox">Late:</label><input id="late_checkbox" type="checkbox" name="late" value="late"></span>

				<button id="add_student" class="btn-grey" type="button" onclick="sendForm();" title="">Add student</button>
			</form>
		</div>

	</div>
</div>
<!-- Students's table end -->

<!-- Students's all fingerprint table -->
<div class="container inlineblock" id="showFingerprintHistory" style="display: none">

	<!-- Go back button -->
	<div class="menu-container">
		<div class="menu-item item-left menu-button">
			<a onclick="switchView(1);" href="#" class="previous round">&#8249;</a>
		</div>

		<div class="menu-item item-left menu-title">
			Fingerprints for Class <span style="font-weight: bold">#<span class="currentClassStat"></span></span>
		</div>
	</div>

	<div class="dropdown">
		<button onclick="myDropFunction('dropdownFPFail')" class="dropbtn">See fingeprint fail<span id="studentFPFailNumber"></span></button>
		<div id="dropdownFPFail" class="dropdown-content">
			<table id="studentFPFail">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentFPFailBody"></tbody>

				<template id="studentFPFailTemplate">
					<tr class="clickable">
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>

	<p></p>

	<div class="dropdown">
		<button onclick="myDropFunction('dropdownFPMaybe')" class="dropbtn">See fingeprint maybe<span id="studentFPMaybeNumber"></span></button>
		<div id="dropdownFPMaybe" class="dropdown-content">
			<table id="studentFPMaybe">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentFPMaybeBody"></tbody>

				<template id="studentFPMaybeTemplate">
					<tr class="clickable">
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>

	<p></p>

	<div class="dropdown">
		<button onclick="myDropFunction('dropdownFPOk')" class="dropbtn">See fingeprint ok<span id="studentFPOkNumber"></span></button>
		<div id="dropdownFPOk" class="dropdown-content">
			<table id="studentFPOk">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentFPOkBody"></tbody>

				<template id="studentFPOkTemplate">
					<tr class="clickable">
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>
</div>
<!-- Students's fingerprint all table end -->

<!-- Students's fingerprint table -->
<div class="container inlineblock" id='studentsFP' style="display: none">

	<div class="menu-container">
		<div class="menu-item item-left menu-button">
			<a onclick="goBackToSwitchView();" href="#" class="previous round">&#8249;</a>
		</div>

		<div class="menu-item item-left menu-title" id="fingerprintTitle">
			<span style="font-weight: bold" id="currentStudent"></span>'s fingerprint
		</div>
	</div>

	<div>
		<table id="studentsFinalConfidenceTable">
			<tbody id="studentsFinalConfidenceBody">
			</tbody>
			<template id="studentsFinalConfidenceTemplate">
			</template>
		</table>
		<div id="editConfidenceDiv" class="center hidden">
			<form id="editConfidence">
				<label for="fp_gps_percent" style="padding: 5px;">Fingerprint
					<input id="fp_gps_percent" class="slider1" name="fp_gps_percent" type="range" min="0" max="100" value="50"><span style="padding: 5px;">Geolocation</span>
				</label>
				<div style="background-color: #e6e6e5"> Apply for:
					<input type="radio" id="classConfidence" name="type_update" value="classConfidence" checked>
					<label for="class"> For this class</label>
					<input type="radio" id="class_and_futureConfidence" name="type_update" value="class_and_futureConfidence">
					<label for="class_and_future"> For this and further classes</label>
					<input type="radio" id="all_classConfidence" name="type_update" value="all_classConfidence">
					<label for="all_class"> For all classes</label>
				</div>
				<div>
					<button onclick="updateConfidence()" type="button" class="btn-grey-blue" style="font-size: small">Update</button>
					<button onclick="defaultConfidence(function(){updateConfidence()})" type="button" class="btn-grey-light-blue" style="font-size: small">Default</button>
					<button onclick="cancelConfidence()" type="button" class="btn-grey" style="font-size: small">Cancel</button>
				</div>
			</form>
		</div>
	</div>




	<div class="center">
		<table id="studentsLocationTable">
			<tbody id="studentsLocationBody">
			</tbody>
			<template id="studentsLocationTemplate">
			</template>
		</table>
		<table id="studentsConfidenceTable">
			<tbody id="studentsConfidenceBody">
			</tbody>
			<template id="studentsConfidenceTemplate">
			</template>
		</table>
	</div>

	<div id="studentsFPDiv"  class="center" style="display:block;">
		<table id="studentsFPTable">
			<thead>
			<tr>
			</tr>
			</thead>
			<tbody id="studentsFPBody"></tbody>

			<template id="studentsFPTemplate">
			</template>
		</table>

		<a id="inf-fp1"><img src="/img/information-button.svg" class="img-button" style="float: right; padding-top: 10px; padding-bottom: 10px"></a>
		<div id="inf-fp1-div">Fingerprint generated by weighing the previous fingerprints with the current one.</div>
	</div>

	<br>


	<div class="container inlineblock" id='studentsFP-alt' style="display: none">
		<div class="center">
			<table id="studentsConfidenceTable-alt3">
				<tbody id="studentsConfidenceBody-alt3">
				</tbody>
				<template id="studentsConfidenceTemplate-alt3">
				</template>
			</table>
		</div>

		<div id="studentsFPDiv-alt3"  class="center" style="display:block;">
			<table id="studentsFPTable-alt3">
				<thead>
				<tr>
				</tr>
				</thead>
				<tbody id="studentsFPBody-alt3"></tbody>

				<template id="studentsFPTemplate-alt3">
				</template>
			</table>
			<a id="inf-fp4"><img src="/img/information-button.svg" class="img-button" style="float: right; padding-top: 10px; padding-bottom: 10px"></a>
			<div id="inf-fp4-div">Fingerprint generated by weighing the previous fingerprints with the current one and checking there there was an already registered one and its distance.</div>
		</div>

		<br>


		<div class="center">
			<table id="studentsConfidenceTable-alt1">
				<tbody id="studentsConfidenceBody-alt1">
				</tbody>
				<template id="studentsConfidenceTemplate-alt1">
				</template>
			</table>
		</div>

		<div id="studentsFPDiv-alt1"  class="center" style="display:block;">
			<table id="studentsFPTable-alt1">
				<thead>
				<tr>
				</tr>
				</thead>
				<tbody id="studentsFPBody-alt1"></tbody>

				<template id="studentsFPTemplate-alt1">
				</template>
			</table>
			<a id="inf-fp2"><img src="/img/information-button.svg" class="img-button" style="float: right; padding-top: 10px; padding-bottom: 10px"></a>
			<div id="inf-fp2-div">Fingerprint generated by comparing the indicators with the ones from the previous attendance.</div>
		</div>

		<br>

		<div class="center">
			<table id="studentsConfidenceTable-alt2">
				<tbody id="studentsConfidenceBody-alt2">
				</tbody>
				<template id="studentsConfidenceTemplate-alt2">
				</template>
			</table>
		</div>

		<div id="studentsFPDiv-alt2"  class="center" style="display:block;">
			<table id="studentsFPTable-alt2">
				<thead>
				<tr>
				</tr>
				</thead>
				<tbody id="studentsFPBody-alt2"></tbody>

				<template id="studentsFPTemplate-alt2">
				</template>
			</table>
		</div>
		<a id="inf-fp3"><img src="/img/information-button.svg" class="img-button" style="float: right; padding-top: 10px; padding-bottom: 10px"></a>
		<div id="inf-fp3-div">Fingerprint generated by comparing the indicators with the most common ones until that attendance.</div>
	</div>
</div>
<!-- Students's fingerprint table end -->

<!-- Students's stats table -->
<div class="container inlineblock" id="showStats" style="display: none">

	<!-- Go back button -->
	<div class="menu-container">
		<div class="menu-item item-left menu-button">
			<a onclick="switchView(1)" href="#" class="previous round">&#8249;</a>
		</div>

		<div class="menu-item item-left menu-title">
			Statistics for Class <span style="font-weight: bold">#<span class="currentClassStat"></span></span>
		</div>
	</div>


	<div class="dropdown">
		<button onclick="myDropFunction('dropdownStatsAttendance')" class="dropbtn">See attended students<span id="studentFullTableNumber"></span></button>
		<div id="dropdownStatsAttendance" class="dropdown-content">
			<table id="studentFullTable">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentFullTableBody"></tbody>

				<template id="studentsFullTemplate">
					<tr>
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>

	<p></p>
	<div class="dropdown">
		<button onclick="myDropFunction('dropdownStatsLateAttendance')" class="dropbtn">See late attended students<span id="studentsLateTableNumber"></span></button>
		<div id="dropdownStatsLateAttendance" class="dropdown-content">
			<table id="studentsLateTable">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentsLateTableBody"></tbody>

				<template id="studentsLateTemplate">
					<tr>
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>

	<p></p>
	<div class="dropdown">
		<button onclick="myDropFunction('dropdownStatsLeftEarlyAttendance')" class="dropbtn">See left early students<span id="studentsEarlyTableNumber"></span></button>
		<div id="dropdownStatsLeftEarlyAttendance" class="dropdown-content">
			<table id="studentsEarlyTable">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentsEarlyTableBody"></tbody>

				<template id="studentsEarlyTemplate">
					<tr>
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>

	<p></p>
	<div class="dropdown">
		<button onclick="myDropFunction('dropdownStatsMiddleAttendance')" class="dropbtn">See middle students<span id="studentsMiddleTableNumber"></span></button>
		<div id="dropdownStatsMiddleAttendance" class="dropdown-content">
			<table id="studentsMiddleTable">
				<thead>
				<tr>
					<td class="headerStat">IST ID</td>
					<td class="headerStat">Name</td>
				</tr>
				</thead>
				<tbody id="studentsMiddleTableBody"></tbody>

				<template id="studentsMiddleTemplate">
					<tr>
						<td></td>
						<td></td>
					</tr>
				</template>
			</table>
		</div>
	</div>
</div>
<!-- Students's stats table end -->


<!-- GO UP! button -->
<div>
	<div id="goUp_spacer"></div>
	<div class="goUp_div" title="Go up">
		<a id="goUp" href="#top">&#9650;</a>
	</div>

	<div style="display: none; position: fixed; bottom: 10px; left: 6px" id="altfpdiv">
		<a class='btn-grey' href="#" id="altfp"
		   onclick="switchView(5)"
		   title="Show alternative fingerprint combinatins">
			<span><img src="/img/alt.svg" class="img-button"> Alternative fingerprint combinations</span>
		</a>
	</div>
</div>


<script>
	const thresh_fail = 0.81
	const thresh_ok = 0.9

	checkIfAdmin();

	function checkIfAdmin(){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200) {
				if (JSON.parse(this.responseText)){
					document.getElementById('admin').style.display = '';
				}
			}
		};

		xhttp.open("GET", '/api/isAdmin', true);
		xhttp.send();
	}

	var tsv_course;
	var tsv_shifts;
	var tsv_classes;

	let regex_line = /^ist\d\d\d\d\d\d,(ok|late)$/;
	let isEditingClass = false;
	let isImportingAttendance = false;
	const urlParams = new URLSearchParams(window.location.search);
	let courseID = urlParams.get("c");
	let historyTable_error = document.getElementById("historyTable_error");
	let currentShift;
	let currentCampus;
	let isAddingShift = false;
	let isEditingProfessors = false;
	let currentAttendanceID;

	if(courseID) {
		historyTable_error.innerHTML = "";
		loadHistory(courseID,"",currentShift, currentCampus);
	} else {
		historyTable_error.innerHTML = "CourseID not defined.";
		document.getElementById("historyTable").style.display = "none";
		document.getElementById("b_attendance").style.display = "none";
	}

	let insertShift_tr = document.getElementById("insertShift_tr"); //add shift form rows
	let create_add_shift = document.getElementById("create_add_shift"); //add shift button
	let shift_th_type = document.getElementsByClassName("shift_th_type");
	let invisible_info_shifts = document.getElementById("invisible-info-shifts");
	let toggle_button = document.getElementById("toggle_button"); //cancel btn
	let shiftOn = document.getElementById("shiftOn");
	let shifttable_main = document.getElementById("shifttable_main"); //shift tables
	let tsv_export_by_secret = document.getElementById("tsv_export_by_secret");
	let professors = document.getElementById("professors"); //professors table
	let prof_title = document.getElementById("prof_title");
	let shift_select = document.getElementById("shift_select"); //type of shift

	isFenixCourse()

	function isFenixCourse(){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200) {

				if (JSON.parse(this.responseText)){
					document.getElementById("fenixCourse").style.display = '';
					document.getElementById("fenixCourseSpan").style.display = '';
				}
			}
		};

		xhttp.open("GET", '/api/isFenixCourse?c='+courseID, true);
		xhttp.send();
	}




	function toggleEditProfessors() {
		if(isEditingProfessors) {
			prof_title.style.display = "none";
			shiftOn.style.display = "";
			shifttable_main.style.display = "";
			tsv_export_by_secret.style.display = "";
			professors.style.display = "none";
		} else {
			prof_title.style.display = "";
			professors.style.display = "";
			shiftOn.style.display = "none";
			shifttable_main.style.display = "none";
			tsv_export_by_secret.style.display = "none";
		}

		isEditingProfessors = !isEditingProfessors;
	}

	function addNewShift(btn){
		insertShift_tr.style.display = "";
		btn.style.display='none';
	}

	function removeNewShift(){
		insertShift_tr.style.display = "none";
		document.getElementById('add_shift').style.display=''
		document.getElementById('insertShift').reset();
	}

	function editShift(shift_row) {
		let shift_table = document.getElementById('shifttable_main')

		let shift_table_template = document.getElementById('shiftTemplate')

		let rows = shift_table.rows
		let editRow
		let editRowIndex
		for (let i = 2; i < rows.length; ++i) {
			if (shift_row && shift_row.cells[0].innerText === rows[i].cells[0].innerText){
				editRow = rows[i]
				editRowIndex = i
			}
		}

		shift_table.deleteRow(editRowIndex);
		let form_row = shift_table.insertRow(editRowIndex);

		let updateShiftForm = document.createElement('form')
		updateShiftForm.setAttribute('id', 'updateShift')

		/* campus */
		let campus = document.createElement('select')
		campus.setAttribute('name', 'campus')
		campus.required = true

		let alameda = document.createElement('option')
		alameda.setAttribute('value', 'Alameda')
		let alameda_text = document.createTextNode('Alameda')
		alameda.appendChild(alameda_text)
		campus.appendChild(alameda)

		let taguspark = document.createElement('option')
		taguspark.setAttribute('value', 'Taguspark')
		let taguspark_text = document.createTextNode('Taguspark')
		taguspark.appendChild(taguspark_text)
		campus.appendChild(taguspark)

		/* pre chosen campus */
		let prev_chosen_campus = shift_row.cells[1].innerText
		if (prev_chosen_campus === 'Alameda') campus.selectedIndex = '0'
		else if  (prev_chosen_campus === 'Taguspark') campus.selectedIndex = '1'

		updateShiftForm.appendChild(campus)

		/* week-day */
		let week_day = document.createElement('select')
		week_day.setAttribute('name', 'week_day')
		week_day.setAttribute('form', 'updateShift')

		let mon = document.createElement('option')
		mon.setAttribute('value', '1')
		let mon_text = document.createTextNode('Mon')
		mon.appendChild(mon_text)
		week_day.appendChild(mon)

		let tue = document.createElement('option')
		tue.setAttribute('value', '2')
		let tue_text = document.createTextNode('Tue')
		tue.appendChild(tue_text)
		week_day.appendChild(tue)

		let wed = document.createElement('option')
		wed.setAttribute('value', '3')
		let wed_text = document.createTextNode('Wed')
		wed.appendChild(wed_text)
		week_day.appendChild(wed)

		let thu = document.createElement('option')
		thu.setAttribute('value', '4')
		let thu_text = document.createTextNode('Thu')
		thu.appendChild(thu_text)
		week_day.appendChild(thu)

		let fri = document.createElement('option')
		fri.setAttribute('value', '5')
		let fri_text = document.createTextNode('Fri')
		fri.appendChild(fri_text)
		week_day.appendChild(fri)

		let sat = document.createElement('option')
		sat.setAttribute('value', '6')
		let sat_text = document.createTextNode('Sat')
		sat.appendChild(sat_text)
		week_day.appendChild(sat)

		let sun = document.createElement('option')
		sun.setAttribute('value', '0')
		let sun_text = document.createTextNode('Sun')
		sun.appendChild(sun_text)
		week_day.appendChild(sun)

		/* pre chosen weekday */
		let prev_chosen_week = shift_row.cells[2].innerText
		if (prev_chosen_week === 'Mon') week_day.selectedIndex = '0'
		else if  (prev_chosen_week === 'Tue') week_day.selectedIndex = '1'
		else if  (prev_chosen_week === 'Wed') week_day.selectedIndex = '2'
		else if  (prev_chosen_week === 'Thu') week_day.selectedIndex = '3'
		else if  (prev_chosen_week === 'Fri') week_day.selectedIndex = '4'
		else if  (prev_chosen_week === 'Sat') week_day.selectedIndex = '5'
		else if  (prev_chosen_week === 'Sun') week_day.selectedIndex = '6'

		/* start */
		let start = document.createElement('input')
		start.setAttribute('name', 'start')
		start.setAttribute('type', 'time')
		start.setAttribute('form', 'updateShift')
		start.value = shift_row.cells[3].innerText

		/* end */
		let end = document.createElement('input')
		end.setAttribute('name', 'end')
		end.setAttribute('type', 'time')
		end.setAttribute('form', 'updateShift')
		end.value = shift_row.cells[4].innerText


		/* room */
		let room = document.createElement('input')
		room.setAttribute('name', 'room')
		room.setAttribute('type', 'text')
		room.setAttribute('form', 'updateShift')
		room.value = shift_row.cells[5].innerText


		/* professors */ 
		let professor = document.createElement('select')
		professor.setAttribute('name', 'professor_id')
		professor.setAttribute('form', 'updateShift')

		let prof_table = document.getElementById('professors')
		for (let i = 1; i < prof_table.rows.length; ++i){
			if (prof_table.rows[i].cells[0].innerHTML) {
				let p = document.createElement('option')
				p.setAttribute('value', prof_table.rows[i].cells[0].innerText)
				let p_text = document.createTextNode(prof_table.rows[i].cells[0].innerText)
				p.appendChild(p_text)
				professor.appendChild(p)
			}
		}


		/* pre chosen professor */
		let prev_prof = shift_row.cells[6].innerText
		for (let i = 1; i < prof_table.rows.length; ++i){
			if (prev_prof === prof_table.rows[i].cells[0].innerHTML) {
				professor.selectedIndex = ''+(i-1)
			}
		}


		/* code type */
		let code_type = document.createElement('select')
		code_type.setAttribute('name', 'code_type')
		code_type.setAttribute('form', 'updateShift')

		let letter = document.createElement('option')
		letter.setAttribute('value', 'L')
		let letter_text = document.createTextNode('L')
		letter.appendChild(letter_text)
		code_type.appendChild(letter)

		let number = document.createElement('option')
		number.setAttribute('value', 'N')
		let number_text = document.createTextNode('N')
		number.appendChild(number_text)
		code_type.appendChild(number)

		let letter_number = document.createElement('option')
		letter_number.setAttribute('value', 'LN')
		let letter_number_text = document.createTextNode('L + N')
		letter_number.appendChild(letter_number_text)
		code_type.appendChild(letter_number)

		/* pre chosen code_type */
		let prev_chosen_ctype = shift_row.cells[7].innerText
		if (prev_chosen_ctype === 'L') code_type.selectedIndex = '0'
		else if  (prev_chosen_ctype === 'N') code_type.selectedIndex = '1'
		else if  (prev_chosen_ctype === 'LN') code_type.selectedIndex = '2'

		/* code length */
		let code_length = document.createElement('select')
		code_length.setAttribute('name', 'code_length')
		code_length.setAttribute('form', 'updateShift')

		let len_3 = document.createElement('option')
		len_3.setAttribute('value', '3')
		let len_3_text = document.createTextNode('3')
		len_3.appendChild(len_3_text)
		code_length.appendChild(len_3)

		let len_4 = document.createElement('option')
		len_4.setAttribute('value', '4')
		let len_4_text = document.createTextNode('4')
		len_4.appendChild(len_4_text)
		code_length.appendChild(len_4)

		let len_5 = document.createElement('option')
		len_5.setAttribute('value', '5')
		let len_5_text = document.createTextNode('5')
		len_5.appendChild(len_5_text)
		code_length.appendChild(len_5)

		let len_6 = document.createElement('option')
		len_6.setAttribute('value', '6')
		let len_6_text = document.createTextNode('6')
		len_6.appendChild(len_6_text)
		code_length.appendChild(len_6)

		let len_7 = document.createElement('option')
		len_7.setAttribute('value', '7')
		let len_7_text = document.createTextNode('7')
		len_7.appendChild(len_7_text)
		code_length.appendChild(len_7)

		let len_8 = document.createElement('option')
		len_8.setAttribute('value', '8')
		let len_8_text = document.createTextNode('8')
		len_8.appendChild(len_8_text)
		code_length.appendChild(len_8)

		/* pre chosen code_type */
		let prev_chocode_length = shift_row.cells[8].innerText
		if (prev_chocode_length === '3') code_length.selectedIndex = '0'
		else if  (prev_chocode_length === '4') code_length.selectedIndex = '1'
		else if  (prev_chocode_length === '5') code_length.selectedIndex = '2'
		else if  (prev_chocode_length === '6') code_length.selectedIndex = '3'
		else if  (prev_chocode_length === '7') code_length.selectedIndex = '4'
		else if  (prev_chocode_length === '8') code_length.selectedIndex = '5'

		/* consecutive codes */
		let consecutivecodes = document.createElement('select')
		consecutivecodes.setAttribute('name', 'consecutivecodes')
		consecutivecodes.setAttribute('form', 'updateShift')

		let c_2 = document.createElement('option')
		c_2.setAttribute('value', '2')
		let c_2_text = document.createTextNode('2')
		c_2.appendChild(c_2_text)
		consecutivecodes.appendChild(c_2)

		let c_3 = document.createElement('option')
		c_3.setAttribute('value', '3')
		let c_3_text = document.createTextNode('3')
		c_3.appendChild(c_3_text)
		consecutivecodes.appendChild(c_3)

		let c_4 = document.createElement('option')
		c_4.setAttribute('value', '4')
		let c_4_text = document.createTextNode('4')
		c_4.appendChild(c_4_text)
		consecutivecodes.appendChild(c_4)

		let c_5 = document.createElement('option')
		c_5.setAttribute('value', '5')
		let c_5_text = document.createTextNode('5')
		c_5.appendChild(c_5_text)
		consecutivecodes.appendChild(c_5)

		let c_6 = document.createElement('option')
		c_6.setAttribute('value', '6')
		let c_6_text = document.createTextNode('6')
		c_6.appendChild(c_6_text)
		consecutivecodes.appendChild(c_6)

		/* pre chosen consecutive */
		let prev_consecutivecodes = shift_row.cells[9].innerText
		if (prev_consecutivecodes === '2') consecutivecodes.selectedIndex = '0'
		if (prev_consecutivecodes === '3') consecutivecodes.selectedIndex = '1'
		else if  (prev_consecutivecodes === '4') consecutivecodes.selectedIndex = '2'
		else if  (prev_consecutivecodes === '5') consecutivecodes.selectedIndex = '3'
		else if  (prev_consecutivecodes === '6') consecutivecodes.selectedIndex = '4'

		/* time codes */
		let code_time = document.createElement('select')
		code_time.setAttribute('name', 'time')
		code_time.setAttribute('form', 'updateShift')

		let t_8 = document.createElement('option')
		t_8.setAttribute('value', '8')
		let t_8_text = document.createTextNode('8')
		t_8.appendChild(t_8_text)
		code_time.appendChild(t_8)

		let t_9 = document.createElement('option')
		t_9.setAttribute('value', '9')
		let t_9_text = document.createTextNode('9')
		t_9.appendChild(t_9_text)
		code_time.appendChild(t_9)

		let t_10 = document.createElement('option')
		t_10.setAttribute('value', '10')
		let t_10_text = document.createTextNode('10')
		t_10.appendChild(t_10_text)
		code_time.appendChild(t_10)

		let t_11 = document.createElement('option')
		t_11.setAttribute('value', '11')
		let t_11_text = document.createTextNode('11')
		t_11.appendChild(t_11_text)
		code_time.appendChild(t_11)

		let t_12 = document.createElement('option')
		t_12.setAttribute('value', '12')
		let t_12_text = document.createTextNode('12')
		t_12.appendChild(t_12_text)
		code_time.appendChild(t_12)

		/* pre chosen consecutive */
		let prev_time = shift_row.cells[10].innerText
		if (prev_time === '8') code_time.selectedIndex = '0'
		if (prev_time === '9') code_time.selectedIndex = '1'
		else if  (prev_time === '10') code_time.selectedIndex = '2'
		else if  (prev_time === '11') code_time.selectedIndex = '3'
		else if  (prev_time === '12') code_time.selectedIndex = '4'

		/* class type */
		let class_type = document.createElement('select')
		class_type.setAttribute('name', 'type')
		class_type.setAttribute('form', 'updateShift')

		let teorica = document.createElement('option')
		teorica.setAttribute('value', 'Teórica')
		let teorica_text = document.createTextNode('Teórica')
		teorica.appendChild(teorica_text)
		class_type.appendChild(teorica)

		let laboratorial = document.createElement('option')
		laboratorial.setAttribute('value', 'Laboratorial')
		let laboratorial_text = document.createTextNode('Laboratorial')
		laboratorial.appendChild(laboratorial_text)
		class_type.appendChild(laboratorial)

		let seminario = document.createElement('option')
		seminario.setAttribute('value', 'Seminário')
		let seminario_text = document.createTextNode('Seminário')
		seminario.appendChild(seminario_text)
		class_type.appendChild(seminario)

		let pratica = document.createElement('option')
		pratica.setAttribute('value', 'Prática')
		let pratica_text = document.createTextNode('Prática')
		pratica.appendChild(pratica_text)
		class_type.appendChild(pratica)

		/* prefedined type */
		let prev_type = shift_row.cells[10].innerText
		if (prev_type === 'Teórica') class_type.selectedIndex = '0'
		if (prev_type === 'Laboratorial') class_type.selectedIndex = '1'
		else if  (prev_type === 'Seminário') class_type.selectedIndex = '2'
		else if  (prev_type === 'Prática') class_type.selectedIndex = '3'

		/* buttons */
		let btn_update = document.createElement('button')
		btn_update.onclick = function() {
			updateShift(shift_row.cells[0].innerText, btn_update)
		}
		let update_text = document.createTextNode('Update')
		btn_update.appendChild(update_text)

		/*let btn_remove = document.createElement('button')
		btn_remove.onclick = function(){
			manuallyRemoveShift(shift_row.cells[0].innerText)
		}
		let remove_text = document.createTextNode('Remove')
		btn_remove.appendChild(remove_text)*/

		let btn_cancel = document.createElement('button')
		btn_cancel.onclick = function(){
			shift_table.deleteRow(editRowIndex);
			let new_shift_row = shift_table.insertRow(editRowIndex);

			for (let i = 0; i < shift_row.cells.length; ++i){
				let cell = new_shift_row.insertCell(i)
				cell.style.textAlign = 'center'
				cell.innerHTML = shift_row.cells[i].innerHTML
				cell.shift_id = shift_row.cells[0].innerHTML
				cell.campus = shift_row.cells[1].innerHTML
				if (i !== 12){
					cell.onclick = function() {
						loadHistory(courseID, null, shift_row.cells[0].innerHTML, shift_row.cells[1].innerHTML);
						switchView(0);
						currentShift = shift_row.cells[0].innerHTML;
						currentCampus = shift_row.cells[1].innerHTML;
						if(shift_row.cells[6].innerHTML && shift_row.cells[6].innerHTML != currentIstID) {
							warningalert.style.display = "";
						} else {
							warningalert.style.display = "none";
						}
						let link = window.location.protocol + "//" + window.location.host + "/tsv/course/shift?s=" + this.secret;
						tsv_shifts = link;
						document.getElementById("tsv_export_shift_by_secret").href = link;
					};
				}

			}
		}
		let cancel_text = document.createTextNode('Cancel')
		btn_cancel.appendChild(cancel_text)


		let cell1 = form_row.insertCell(0)
		let cell2 = form_row.insertCell(1)
		let cell3 = form_row.insertCell(2)
		let cell4 = form_row.insertCell(3)
		let cell5 = form_row.insertCell(4)
		let cell6 = form_row.insertCell(5)
		let cell7 = form_row.insertCell(6)
		let cell8 = form_row.insertCell(7)
		let cell9 = form_row.insertCell(8)
		let cell10 = form_row.insertCell(9)
		let cell11 = form_row.insertCell(10)
		let cell12 = form_row.insertCell(11)
		let cell13 = form_row.insertCell(12)

		cell1.innerHTML = shift_row.cells[0].innerText
		cell1.style.textAlign = 'center'
		cell2.appendChild(updateShiftForm)
		cell3.appendChild(week_day)
		cell4.appendChild(start)
		cell5.appendChild(end)
		cell6.appendChild(room)
		cell7.appendChild(professor)
		cell8.appendChild(code_type)
		cell9.appendChild(code_length)
		cell10.appendChild(consecutivecodes)
		cell11.appendChild(code_time)
		cell12.appendChild(class_type)
		cell13.appendChild(btn_update)
		cell13.appendChild(btn_cancel)
	}

	function insertProfessorIntoCourse() {

		let formEl = document.getElementById("insertProfessor");
		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}
		let data = new FormData(formEl);
		let o = {};
		o.courseID = courseID;
		for(let e of data) {
			o[e[0]] = e[1];
		}

		let json_string = JSON.stringify(o);
		let xhttp = new XMLHttpRequest();
		let url = "/api/insertprofessor";
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200) {
				formEl.reset();
				document.getElementById('insertProfessor').style.display = 'none';
				document.getElementById('add_professor').style.display = '';
				let prof_table = document.getElementById('professors')

				loadProfessorsByCourse(window.location.href.split('c=')[1].slice(0, -1))
			}
		}

		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function removeProfessorFromCourse(button_element) {
		let o = {};
		o.courseID = courseID;
		o.ist_id = button_element.parentElement.parentElement.children[0].innerText;

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			let xhttp = new XMLHttpRequest();
			let url = "/api/removeprofessor";
			xhttp.onreadystatechange = function() {
				if(this.readyState === 4 && this.status === 200) {
					loadProfessorsByCourse(courseID);
				}
			}

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to remove this professor from lecturing this course?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);

	}

	// turn "index.name" into array of objects
	function splitPrefixedName(data){
		let res_array = [];
		let default_obj = {};

		for(let e of data) {
			let name = e[0].split(".");
			let value = e[1];
			if(name.length === 1){
				default_obj[name[0]] = value;
			}else{
				if(!res_array[name[0]]){
					res_array[name[0]] = {};
				}
				res_array[name[0]][name[1]] = value;
			}
		}
		return {
			to_update: res_array,
			to_insert: default_obj
		};
	}
	function removeShiftForm_after(){
		invisible_info_shifts.old_style_display = "none";
		loadShiftsByCourseID();
		loadProfessorsByCourse(courseID);
	}

	function updateShift(shift_id, btn){
		let form_elements = document.getElementById('updateShift').elements;
		let o = {}

		o.campus = form_elements[0].value;
		o.code_length = form_elements[7].value;
		o.code_type = form_elements[6].value;
		o.consecutivecodes = form_elements[8].value;
		o.courseID = courseID
		o.end = form_elements[3].value;
		o.professor_id = form_elements[5].value;
		o.room = form_elements[4].value;
		o.shift_id = shift_id
		o.start = form_elements[2].value;
		o.time = form_elements[9].value;
		o.type = form_elements[10].value;
		o.update = true;
		o.week_day = form_elements[1].value;

		if (o.end < o.start) {
			myAlert('End time needs to be after start time.')
			return false;
		}

		let json_string = JSON.stringify(o);
		let xhttp = new XMLHttpRequest();
		let url = "/api/insertshift";
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200){
				btn.disabled = false;
				loadShiftsByCourseID();
				removeNewShift();
			}
		}
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function insertShiftForm(btn, update=false){
		let formEl = document.getElementById("insertShift");

		btn.disabled = true;

		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}

		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			o[e[0]] = e[1];

		}
		o.courseID = courseID;
		o.update = update;

		if (o.end < o.start) {
			myAlert('End time needs to be after start time.')
			btn.disabled = false;
			return false;
		}
		let json_string = JSON.stringify(o);
		let xhttp = new XMLHttpRequest();
		let url = "/api/insertshift";
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200){
				btn.disabled = false;
				loadShiftsByCourseID();
				removeNewShift();
			}
		}
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function goTo(url) {
		window.location.replace(url);
	}

	function goTo1(url) {
		let last_att = document.getElementById("studentsTable").rows[0].cells.length-6 /*get columns that were attendance in page */
		let att = '&a='+last_att
		let cl = '&cl='+document.getElementById("currentClass").innerText
		window.location.replace(url+att+cl);
	}

	let myFile_attendances = document.getElementById("myFile_attendances");
	let sendImportAttendance = document.getElementById("sendImportAttendance");

	function verifyTextArea() {

		let text = myFile_attendances.value;
		let lines = text.split('\n');

		for(let l of lines) {
			if(!l.match(regex_line)) {
				console.log('Invalid line:', l);
				myFile_attendances.classList.add("invalidLine");
				sendImportAttendance.disabled = true;
				return;
			}
		}
		sendImportAttendance.disabled = false;
		myFile_attendances.classList.remove("invalidLine");
	}

	function sendFileAsForm(){

		let formEl = document.getElementById("importAttendanceID");
		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			o[e[0]] = e[1];
		}
		o.courseID = courseID;

		let json_string = JSON.stringify(o);
		let xhttp = new XMLHttpRequest();
		let url = "/api/importattendance";
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4 && this.status === 200) {
				toggleImport();
				formE1.reset;
				loadHistory(courseID,null,currentShift,currentCampus);
			}
		}
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}


	function cancelAction(button_element) {
		document.getElementById("classInfo").style.display = "";
		document.getElementById("editClassInfo").style.display = "none";

		isEditingClass = false;
	}

	function editTitleNumber(button_element) {

		document.getElementById("editClassInfo").style.display = "";
		document.getElementById("editButton").classList.add("active");

		let attendanceID = button_element.attendanceID;

		isEditingClass = true;

		loadAttendanceInformation("/api/attendanceinfo?a="+attendanceID, attendanceID);
	}

	function toggleEdit(button_element) {

		if(isEditingClass) {
			return cancelAction(button_element);
		} else {
			return editTitleNumber(button_element);
		}
	}

	function toggleImport() {

		if(isImportingAttendance) {
			return cancelImport();
		} else {
			return importAttendance();
		}
	}

	function importAttendance(){ 


		document.getElementById("b_attendance").style.display = "none";
		document.getElementById("import_button").classList.add("active");
		document.getElementById("teacherOn").style.display = "none";
		document.getElementById("historyTable").style.display = "none";
		document.getElementById("importAttendanceDiv").style.display = "";
		isImportingAttendance = true;
	}

	function cancelImport() {

		document.getElementById("b_attendance").style.display = "";
		document.getElementById("import_button").classList.remove("active");
		document.getElementById("teacherOn").style.display = "";
		document.getElementById("historyTable").style.display = "";
		document.getElementById("importAttendanceDiv").style.display = "none";
		isImportingAttendance = false;
	}


	function loadShiftsByCourseID() {

		let url = "/api/getshifts?c=" + courseID;
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let shifts = JSON.parse(this.responseText);

					for (let i = 0; i < shifts.length; ++i) {
						if (shifts[i]['codelength'] === null) shifts[i]['codelength'] = 6;
						if (shifts[i]['codetype'] === null) shifts[i]['codetype'] = 'LN';
						if (shifts[i]['consecutive'] === null) shifts[i]['consecutive'] = 3;
						if (shifts[i]['time'] === null) shifts[i]['time'] = 10;
						if (shifts[i]['prof_id'] === null) shifts[i]['prof_id'] = 'Not assigned';
					}
					updateSelectShift(shifts);
				} else {
					console.log("Error loading shifts:", this.status);
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	let global_shifts_wrapper;

	function updateSelectShift(shifts) {

		global_shifts_wrapper = shifts;
		let template = document.getElementById("shiftOnTemplate");
		let select = document.getElementById("shift_select");
		let types = [];

		removeSelectOptions("shift_select");

		for(let s of shifts) {
			if(!types.includes(s.type) && s.shift_id) {
				types.push(s.type);
			}
		}

		for(let s of shifts) {
			if(!types.includes(s.campus) && s.shift_id) {
				types.push(s.campus);
			}
		}
		types.push('All');

		for(let i = 0; i < types.length; i++) {
			let option = template.content.querySelector("option").cloneNode(true);
			option.value = option.innerText = types[i];
			select.appendChild(option);

			if(types[i] === "Teórica") {
				select.selectedIndex = i;
			}
		}

		changeShift(select);
	}


	let current_shift_type;

	function changeShift(select) {

		current_shift_type = select.value;
		showShifts(select.value);
	}

	function showShifts(myType = "Teórica", edit = false, shiftID = null) {
		let template = document.getElementById("shiftTemplate");
		let table = document.getElementById("shiftTable");
		let shifts = global_shifts_wrapper;
		removeTrs(table.getElementsByTagName("tr"), 2, 1);
		let ids_consecutive = 0;
		let select = document.getElementById("shift_select");

		if(shifts.length > 0) {
			for(let i = 1; i < shifts.length; i++) {
				if(shifts[i].shift_id === shifts[i-1].shift_id) {
					let first_index = shifts[i-1].first_index;
					if(first_index) {
						if(shifts[first_index].repeatedCount) {
							shifts[first_index].repeatedCount ++;
						} else {
							shifts[i].repeatedCount = 1;
							shifts[first_index].repeatedCount = 1;
						}
					} else {
						shifts[i].first_index = i-1;
						shifts[i-1].repeatedCount = 2;
					}
				}
			}
			let tr_i = 0;
			for(let i = 0; i < shifts.length; i++) {
				let shifts_i = shifts[i];
				if(shifts_i.type === myType || shifts_i.campus === myType || myType === 'All') {
					addShifts(table, template, shifts_i, shifts_i.secret, shifts_i.id, shifts_i.shift_id, shifts_i.campus, shifts_i.week_day, shifts_i.start, shifts_i.end, shifts_i.room, shifts_i.prof_id, shifts_i.codetype, shifts_i.codelength, shifts_i.consecutive, shifts_i.time, shifts_i.type, edit, tr_i++);
				}
			}
		} else {
			document.getElementById("invisible-info-shifts").style.display = "";
			document.getElementById("shiftOn").style.display = "none";
		}
	}

	let warningalert = document.getElementById("warningalert");
	const week_day_list = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

	function addShifts(table, template, shifts_i, secret, shift_uid, id, campus, week_day, start, end, room, professor, c_type, length, consecutive, time, s_type, edit, tr_i) {
		let tds
		let tr_clone = template.content.querySelector("tr").cloneNode(true);
		if(edit) {
			tds = tr_clone.querySelectorAll("input,select");
		}else {
			tds = tr_clone.children;
		}
		tr_clone.shift_id = id;
		tr_clone.shift_uid = shift_uid;
		tr_clone.campus = campus;
		tr_clone.secret = secret;
		tr_clone.responsibleprofessor = professor;
		tr_clone.class = 'clickable'


		start = start.substring(0,5);
		end = end.substring(0,5);

		if(edit) {
			for(let x = 0; x < tds.length; x++) {
				tds[x].value = arguments[x+4];
				tds[x].name = (tr_i + "." + tds[x].name);

			}
		} else {
			week_day = week_day_list[week_day];
			for(let x = 0; x < tds.length-1; x++) { //-1 because of the edit button
				tds[x].innerText = arguments[x+5];
				tds[x].onclick = function() {
					loadHistory(courseID, null, tds[0].innerText, tds[1].innerText);
					switchView(0);
					currentShift = tds[0].innerText;
					currentCampus = tds[1].innerText;
					if(tds[6].innerText  && tds[6].innerText !== currentIstID) {
						warningalert.style.display = "";
					} else {
						warningalert.style.display = "none";
					}
					let link = window.location.protocol + "//" + window.location.host + "/tsv/course/shift?s=" + this.closest('tr').secret;
					tsv_shifts = link;
					document.getElementById("tsv_export_shift_by_secret").href = link;
				};
			}
			if(shifts_i.first_index != undefined) {
				tds[1].parentElement.removeChild(tds[1]);		// remove 1o a coluna CAMPUS
				tds[0].parentElement.removeChild(tds[0]);
			} else if(shifts_i.repeatedCount) {
				tds[0].rowSpan = shifts_i.repeatedCount;
				tds[1].rowSpan = shifts_i.repeatedCount;
			}

		}

		table.insertBefore(tr_clone, table.childNodes[table.childNodes.length-2]);
	}

	function enterShift(tr){
		loadHistory(courseID, null, tr.children[0].innerText, tr.children[1].innerText);
		switchView(0);
		currentShift = tr.children[0].innerText;
		currentCampus = tr.children[1].innerText;
		if(tr.children[6].innerText  && tr.children[6].innerText !== currentIstID) {
			warningalert.style.display = "";
		} else {
			warningalert.style.display = "none";
		}
		let link = window.location.protocol + "//" + window.location.host + "/tsv/course/shift?s=" + tr.secret;
		tsv_shifts = link;
		document.getElementById("tsv_export_shift_by_secret").href = link;
	}


	function sendClassInformation(){
		let formE1 = document.getElementById("editClassInfoForm");
		let data = new FormData(formE1);
		let o = {};
		for(let e of data) {
			o[e[0]] = e[1];
		}
		let table = document.getElementById("studentsTable");

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			let xhttp = new XMLHttpRequest();
			let url = "/api/updateClassInformation?a="+table.attendanceID;
			xhttp.onreadystatechange = function() {
				if(this.readyState === 4 && this.status === 200) {
					document.getElementById("editButton").classList.remove("active");
					document.getElementById("classInfo").style.display = "";
					document.getElementById("editClassInfo").style.display = "none";

					let table = document.getElementById("studentsTable");
					let classcounter = table.classcounter;
					loadStudents('/api/getattendancehistory?rid='+table.attendanceID, classcounter);
					loadAttendanceInformation("/api/attendanceinfo?a="+table.attendanceID,table.attendanceID);
				}
			};

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to update this information?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function loadAttendanceInformation(url, attendanceID) {

		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let attendanceInfo = JSON.parse(this.responseText);
					document.getElementById("addTitle").value = attendanceInfo.title;
					if(attendanceInfo.is_extra === 1) {
						document.getElementById("addIsExtra").checked = 1;
					} else {
						document.getElementById("addIsExtra").checked = 0;
					}
					document.getElementById("addClassCounter").value = attendanceInfo.number;
					document.getElementById("currentClass").innerHTML = attendanceInfo.number;
					document.getElementById("currentTitle").innerHTML = attendanceInfo.title;

					if(attendanceInfo.number > 0) {
						document.getElementById("currentClassDiv").style.display = "";

					} else {			// in case is extra class (and no number)
						document.getElementById("currentTitleDiv").style.display = "";
						document.getElementById("currentClassDiv").style.display = "none";
					}
				} else {
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	function changeProfessor() {

		let select = document.getElementById("professor_select");
		loadHistory(courseID, select.value, currentShift, currentCampus);
	}

	function loadHistory(mycourseID, ist_id, shift, campus) {
		let url = "/api/history?c=" + mycourseID + (ist_id ? ("&i=" + ist_id) : "") + "&s=" + shift;
		currentShift = shift;
		document.getElementById("currentShift_display").innerHTML = currentShift;
		document.getElementById("currentCampus_display").innerHTML = campus;
		document.getElementById("importattendance_shift").value = currentShift;
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let history = JSON.parse(this.responseText);
					showHistory(history);
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	function loadProfessorsByCourse(courseID) {
		let url = "/api/professorsbycourse?c="+courseID;
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let json = JSON.parse(this.responseText);
					showProfessors(json);
				} else {
					console.log("Error loading professor by course:", this.status);
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	let currentIstID;

	function showProfessors(json) {
		currentIstID = json.ist_id;

		/* populatable professors */
		let profs = json.rows;
		let table = document.getElementById("professorstable");
		table.innerHTML = '';

		/* recreate professor table */
		let row = table.insertRow(0);
		row.style.textAlign = 'center'
		row.style.cursor = 'not-allowed'

		let h1 = document.createElement("th");
		let t1 = document.createTextNode("ID");
		h1.appendChild(t1);

		let h2 = document.createElement("th");
		let t2 = document.createTextNode("Name");
		h2.appendChild(t2);

		row.appendChild(h1);
		row.appendChild(h2);


		for(let i = 0; i < profs.length; i++) {
			addProfessor(table, profs[i].ist_id, profs[i].name);
		}

		/* populate options for form add shift */
		let select = document.getElementById("professor_select_all");
		let teacherOn = document.getElementById('professor_select');

		for(let i = 0; i < profs.length; i++) {
			let option = document.createElement('option')
			option.setAttribute('value', profs[i].ist_id)
			let option_text = document.createTextNode(profs[i].ist_id)
			option.appendChild(option_text)
			select.appendChild(option)
		}

		for(let i = 0; i < profs.length; i++) {
			let option = document.createElement('option')
			option.setAttribute('value', profs[i].ist_id)
			let option_text = document.createTextNode(profs[i].ist_id)
			option.appendChild(option_text)
			teacherOn.appendChild(option)
		}
	};

	//function addProfessor(table, template, ist_id, name) {
	function addProfessor(table, ist_id, name) {
		let row = table.insertRow(1);
		row.style.textAlign = 'center'
		row.style.cursor = 'not-allowed'
		let cell1 = row.insertCell(0)
		let cell2 = row.insertCell(1)
		let cell3 = row.insertCell(2)

		cell1.innerText = ist_id
		cell2.innerText = name
		cell3.innerHTML = '<button type="button" onClick="removeProfessorFromCourse(this)"><img src="/img/delete.svg" className="img-button" width="20px"></button>'
	}

	function removeSelectOptions(id) {
		let x = document.getElementById(id);
		for(let l = x.length-1; l >= 0; l--) {
			x.remove(l);
		}
	}



	function showHistory(history_wrapper) {
		let template = document.getElementById("historyTemplate");
		let table = document.getElementById("historyTable");
		let history = history_wrapper.history.rows;
		table.ist_id = history_wrapper.history.ist_id;
		removeTrs(table.getElementsByTagName("tr"));
		document.getElementById("professor_select").value = table.ist_id;
		document.getElementById("courseName_id").innerHTML = history_wrapper.courseName;
		document.getElementById("courseName_id2").innerHTML = history_wrapper.courseName;
		let secret = history_wrapper.secret;

		if (document.getElementById("tsv_export_by_secret")){
			let url = window.location.protocol + "//" + window.location.host + "/tsv/course?s=" +  secret;
			tsv_course = url
			document.getElementById("tsv_export_by_secret").href = url;
		}

		if(history.length > 0) {
			document.getElementById("noAttendancesText").style.display = "none";
			document.getElementById("attendancesTitle").style.display = "";
			document.getElementById("historyTable").style.display = "";
			let classes = [];
			for(let i = 0; i < history.length; i++) {
				if (!classes.includes(history[i].number)) {
					classes.push(history[i].number)
				}
			}

			let groupClasses = []
			for (let i = 0; i < classes.length; ++i){
				let aux = []
				for (let j = 0; j < history.length; ++j){
					if (!aux.includes(history[j]) && classes[i] === history[j].number){
						aux.push(history[j])
					}
				}
				groupClasses.push(aux)
			}

			for (let i = 0; i < groupClasses.length; ++i){
				let hist_i = groupClasses[i][0]
				addHistory(table, template, hist_i.secret, hist_i.attendanceID, hist_i.number, hist_i.title, hist_i.date, hist_i.code_type, hist_i.code_length, hist_i.total_time_s, hist_i.consecutive_codes, hist_i.count, hist_i.is_extra, hist_i.remote);
				addAttendancesToShiftTable(table, template, hist_i.number);
			}
		} else {
			document.getElementById("historyTable").style.display = "none";
			document.getElementById("noAttendancesText").style.display = "";
			document.getElementById("attendancesTitle").style.display = "none";
		}

	};

	function addHistory(table, template, secret, attendanceID, classcounter, mytitle, date, code_type, code_length, total_time_s, consecutive_codes, count, is_extra, is_remote) {

		let tr_clone = template.content.querySelector("tr").cloneNode(true);
		let tds = tr_clone.children;
		tr_clone.myattendanceID = attendanceID;
		tr_clone.classcounter = classcounter;
		tr_clone.mytitle = mytitle;
		tr_clone.secret = secret;
		tds[0].innerText = classcounter;

		for(let x = 1; x < tds.length - 1; x++) {	//a partir de "date"
			tds[x].style.textAlign = 'center'
			if (x === 8 || x === 9){
				if (x === 8) {
					tds[x].innerHTML = (is_extra ? '<img src="/img/check.svg" class="img-button" alt="">' : '<img src="/img/cross.svg" class="img-button" alt="">')
				}
				if (x === 9) {
					tds[x].innerHTML = (is_remote ? '<img src="/img/check.svg" class="img-button" alt="">' : '<img src="/img/cross.svg" class="img-button" alt="">')
				}
			} else
				tds[x].innerText = arguments[x+4];
		}

		for(let x = 0; x < tds.length - 1; x++) {	//a partir de "date"
			tds[x].onclick = function() {
				currentAttendanceID = this.closest('tr').myattendanceID
				loadStudents("/api/getattendancehistory?rid="+this.closest('tr').myattendanceID, this.closest('tr').classcounter, mytitle);
				switchView(1);
				document.getElementById("currentClass").innerText = classcounter;

				let link = window.location.protocol + "//" + window.location.host + "/tsv/course/class?s=" + this.closest('tr').secret;
				tsv_classes = link
				document.getElementById("tsv_export_class_by_secret").href = link;
			};
		}

		table.appendChild(tr_clone);
	}

	function enterClass(tr){
		currentAttendanceID = tr.myattendanceID
		loadStudents("/api/getattendancehistory?rid="+tr.myattendanceID, tr.classcounter, '');
		switchView(1);
		document.getElementById("currentClass").innerText = tr.children[0].innerText;

		let link = window.location.protocol + "//" + window.location.host + "/tsv/course/class?s=" + tr.secret;
		tsv_classes = link
		document.getElementById("tsv_export_class_by_secret").href = link;
	}

	function addAttendancesToShiftTable(table, template, classNumber) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let at = JSON.parse(this.responseText);
					for (let row of table.rows) {
						if (row.cells[0].innerText === classNumber.toString() && row.cells[10].classList[0] === 'classattendances'){
							row.cells[10].innerText = ''+ at;
							row.cells[10].style.textAlign = 'center';
						}
					}
				} else {
					console.log("Error loading students:", this.status);
				}
			}
		};
		xhttp.open("GET", "/api/attedancesbyClassNumber?cl="+classNumber+'&c='+courseID+'&s='+currentShift, true);
		xhttp.send();
	}

	function loadName(url) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					document.getElementById("IST_NAME").innerHTML = this.responseText;
				} else {
					document.getElementById("IST_NAME").innerHTML = "<i>error getting username: " + this.status + "</i>";
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	function loadStudents(url, classcounter, title) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let studentshistory = JSON.parse(this.responseText);
					showStudents(studentshistory, classcounter, title);
					updateAllUsers();
				} else {
					console.log("Error loading students:", this.status);
				}
			}
		};
		xhttp.open("GET", url+'&cl='+classcounter+'&c='+courseID+'&s='+currentShift, true);
		xhttp.send();
	}

	function updateAllUsers(){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					updateSearchStudentListForm(JSON.parse(this.responseText));
				} else {
					console.log("Error loading students:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/getallusers', true);
		xhttp.send();
	}

	function getAllLocation(url, ist_id, hasAlternativeFingerprint){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = async function () {
			if (this.readyState === 4) {
				if (this.status === 200) {
					// parse location per attendance for only one student
					let parseByStudent =  Object.assign({}, JSON.parse(this.responseText));
					for (let k of Object.keys(parseByStudent)) {
						for (let i = 0; i < parseByStudent[k].length; ++i){
							if (parseByStudent[k][i].ist_id !== ist_id){
								parseByStudent[k].splice(i, 1)
							}
						}
						if (parseByStudent[k].length < 1){
							delete parseByStudent[k]
						}
					}
					getAllFingerprint('/api/getAllFingerprintData?cl=' + document.getElementById('currentClass').innerText + '&c=' + courseID + '&s=' + currentShift + '&sid=' + ist_id, ist_id, true, parseByStudent, hasAlternativeFingerprint, function (s) {})
				}
				else  {
					console.log('Error getting all location')
				}
			}

		}
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	function getAllFingerprint(url, ist_id, allindicators, location, hasAlternativeFingerprint, callback){
		let xhttp_fixed = new XMLHttpRequest();
		xhttp_fixed.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let ind = ['useragent', 'ip', 'languages', 'colorDepth', 'deviceMemory', 'hardwareConcurrency', 'screenResolution', 'availableScreenResolution', 'sessionStorage', 'localStorage', 'platform', 'plugins', 'fonts', 'audio', 'gpu', 'adBlock', 'pixelDepth']
					let new_ind = JSON.parse(this.responseText);
					if (new_ind !== null) {
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = new_ind[i];
						})
					} else {
						let ind_default = {useragent: 2, ip : 3, languages : 1, colorDepth : 4, deviceMemory : 3, hardwareConcurrency : 3, screenResolution : 4, availableScreenResolution : 3, sessionStorage : 1, localStorage : 1, platform : 3, plugins : 3, fonts : 3, audio : 4, gpu : 4, adBlock: 4, pixelDepth: 4}
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = ind_default[i];
						})
					}

					let xhttp = new XMLHttpRequest();
					xhttp.onreadystatechange = async function () {
						if (this.readyState === 4) {
							if (this.status === 200) {
								let fp = JSON.parse(this.responseText)
								// parse attendances that did not happen aka every indicatior is null apart from ip and useragent
								for (let i = 0; i < fp.length; ++i){
									if (fp[i].platform === null){ //todo maybe change?
										fp.splice(i, 1);
									}
								}

								let fp_array = {"languages":[], "colorDepth":[], "deviceMemory":[], "hardwareConcurrency":[], "screenResolution":[], 'availableScreenResolution':[],
									"sessionStorage":[], "localStorage":[], "platform":[], "plugins":[],"pixelDepth":[], "adBlock":[], "fonts":[], "audio":[],
									"gpu":[], 'useragent':[],'ip':[]};
								for (let k of Object.keys(fp_array)){
									for (let i = 0; i < fp.length; ++i){
										fp_array[k].push(fp[i][k])
									}
								}

								let attendances_mobile_pc = []

								let fp_mobile = []
								let fp_pc = []
								for (let i = 0; i < fp.length; ++i) {
									if (fp[i].useragent && fp[i].gpu && fp[i].platform){
										if (fp[i].useragent.includes('Android') || fp[i].gpu.includes('Adreno') || fp[i].useragent.includes('BlackBerry') || (fp[i].useragent.includes('iPhone')  && fp[i].platform.includes('iPhone')) || (fp[i].useragent.includes('iPad') && fp[i].platform.includes('iPad')) || (fp[i].useragent.includes('iPod') && fp[i].platform.includes('iPod')) || fp[i].useragent.includes('Opera Mini') || fp[i].useragent.includes('IEMobile') || fp[i].useragent.includes('WPDesktop')) {
											fp_mobile.push(fp[i])
											attendances_mobile_pc.push('mobile')
										} else {
											fp_pc.push(fp[i])
											attendances_mobile_pc.push('pc')
										}
									} else {
										if (fp[i].useragent){
											if (fp[i].useragent.includes('Android') || fp[i].useragent.includes('BlackBerry') || (fp[i].useragent.includes('iPhone')  && fp[i].platform.includes('iPhone')) || (fp[i].useragent.includes('iPad') && fp[i].platform.includes('iPad')) || (fp[i].useragent.includes('iPod') && fp[i].platform.includes('iPod')) || fp[i].useragent.includes('Opera Mini') || fp[i].useragent.includes('IEMobile') || fp[i].useragent.includes('WPDesktop')) {
												fp_mobile.push(fp[i])
												attendances_mobile_pc.push('mobile')
											} else {
												fp_pc.push(fp[i])
												attendances_mobile_pc.push('pc')
											}
										}
									}

								}

								let s_pc = null
								let s_mobile = null
								let last_attendace_id = ''
								if (fp_pc.length > 0 && fp_mobile.length === 0)	last_attendace_id = 'pc'
								else if (fp_pc.length === 0 && fp_mobile.length > 0) last_attendace_id = 'mobile'
								else if (fp_pc.length > 0 && fp_mobile.length > 0 && fp_pc[fp_pc.length-1].attendanceID > fp_mobile[fp_mobile.length-1].attendanceID) last_attendace_id = 'pc'
								else if (fp_pc.length > 0 && fp_mobile.length > 0 && fp_pc[fp_pc.length-1].attendanceID < fp_mobile[fp_mobile.length-1].attendanceID) last_attendace_id = 'mobile'
								else last_attendace_id = 'undefined'

								if (fp_pc.length > 0)
									s_pc = await calculateFPWeightForAllIndicators(fp_pc) //s_pc = (allindicators ? await calculateFPWeightForAllIndicators(fp_pc) : await calculateFPWeight(fp_pc))
								if (fp_mobile.length > 0)
									s_mobile = await calculateFPWeightForAllIndicators(fp_mobile) //s_mobile = (allindicators ? await calculateFPWeightForAllIndicators(fp_mobile) : await calculateFPWeight(fp_mobile))

								if (allindicators) {
									// combine pc & mobile
									let all_attendance_confidence = {}
									let all_indicator_confidence = {}
									let all_weight_attendance = {}
									//attendance_confidence, attendance_indicator_flag

									if (s_pc) {
										for (let k of Object.keys(s_pc['attendance_confidence'])) {
											all_attendance_confidence[k] = s_pc['attendance_confidence'][k]
										}
										for (let k of Object.keys(s_pc['attendance_indicator_flag'])) {
											all_indicator_confidence[k] = s_pc['attendance_indicator_flag'][k]
										}
										for (let k of Object.keys(s_pc['array_weight_attendance'])) {
											all_weight_attendance[k] = s_pc['array_weight_attendance'][k]
										}

									}
									if (s_mobile) {
										for (let k of Object.keys(s_mobile['attendance_confidence'])) {
											all_attendance_confidence[k] = s_mobile['attendance_confidence'][k]
										}
										for (let k of Object.keys(s_mobile['attendance_indicator_flag'])) {
											all_indicator_confidence[k] = s_mobile['attendance_indicator_flag'][k]
										}
										for (let k of Object.keys(s_mobile['array_weight_attendance'])) {
											all_weight_attendance[k] = s_mobile['array_weight_attendance'][k]
										}
									}

									let sorted_all_attendance_confidence = sortOnKeys(all_attendance_confidence)
									let sorted_all_indicator_confidence = sortOnKeys(all_indicator_confidence)
									let sorted_all_weight_attendance = sortOnKeys(all_weight_attendance)
									if (!hasAlternativeFingerprint) {
										getFixedThresh(function(){
											getConfidenceWeight(function(){
												loadfpForOneStudent(ist_id, sorted_all_attendance_confidence, sorted_all_indicator_confidence, fp_array, sorted_all_weight_attendance, attendances_mobile_pc, location)
											});
										})
										switchView(4);

									} else {
										// for default fingerprint table
										getFixedThresh(function(){
											getConfidenceWeight(function(){
												loadfpForOneStudent(ist_id, sorted_all_attendance_confidence, sorted_all_indicator_confidence, fp_array, sorted_all_weight_attendance, attendances_mobile_pc, location)
											});
										})
										//todo alternative fingerprinting
										// fp_mobile, fp_pc

										// ********** ALTERNATIVE 1 - JUST COMPARE WITH PREVIOUS VALUE, IF DIFFERENTE FLAG *******
										let s_pc_alt1 = null
										let s_mobile_alt1 = null
										if (fp_pc.length > 0)
											s_pc_alt1 = await fpAlternativeCompWithPrevious(fp_pc)
										if (fp_mobile.length > 0)
											s_mobile_alt1 = await fpAlternativeCompWithPrevious(fp_mobile)

										// combine pc & mobile alternative 1
										let all_attendance_confidence_alt1 = {}
										let all_indicator_confidence_alt1 = {}
										if (s_pc_alt1) {
											for (let k of Object.keys(s_pc_alt1['attendance_confidence'])) {
												all_attendance_confidence_alt1[k] = s_pc_alt1['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_pc_alt1['attendance_indicator_flag'])) {
												all_indicator_confidence_alt1[k] = s_pc_alt1['attendance_indicator_flag'][k]
											}
										}
										if (s_mobile_alt1) {
											for (let k of Object.keys(s_mobile_alt1['attendance_confidence'])) {
												all_attendance_confidence_alt1[k] = s_mobile_alt1['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_mobile_alt1['attendance_indicator_flag'])) {
												all_indicator_confidence_alt1[k] = s_mobile_alt1['attendance_indicator_flag'][k]
											}
										}

										let sorted_all_attendance_confidence_alt1 = sortOnKeys(all_attendance_confidence_alt1)
										let sorted_all_indicator_confidence_alt1 = sortOnKeys(all_indicator_confidence_alt1)

										loadfpForOneStudentAlt1(ist_id, sorted_all_attendance_confidence_alt1, sorted_all_indicator_confidence_alt1, fp_array, attendances_mobile_pc)

										// ********** ALTERNATIVE 2 - COMPARE WITH MOST FREQUENT, IF DIFFERENT FLAG *******
										let s_pc_alt2 = null
										let s_mobile_alt2 = null
										if (fp_pc.length > 0)
											s_pc_alt2 = await fpAlternativeCompWithMostFrequent(fp_pc)
										if (fp_mobile.length > 0)
											s_mobile_alt2 = await fpAlternativeCompWithMostFrequent(fp_mobile)

										// combine pc & mobile alternative 2
										let all_attendance_confidence_alt2 = {}
										let all_indicator_confidence_alt2 = {}
										if (s_pc_alt2) {
											for (let k of Object.keys(s_pc_alt2['attendance_confidence'])) {
												all_attendance_confidence_alt2[k] = s_pc_alt2['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_pc_alt2['attendance_indicator_flag'])) {
												all_indicator_confidence_alt2[k] = s_pc_alt2['attendance_indicator_flag'][k]
											}
										}
										if (s_mobile_alt2) {
											for (let k of Object.keys(s_mobile_alt2['attendance_confidence'])) {
												all_attendance_confidence_alt2[k] = s_mobile_alt2['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_mobile_alt2['attendance_indicator_flag'])) {
												all_indicator_confidence_alt2[k] = s_mobile_alt2['attendance_indicator_flag'][k]
											}
										}

										let sorted_all_attendance_confidence_alt2 = sortOnKeys(all_attendance_confidence_alt2)
										let sorted_all_indicator_confidence_alt2 = sortOnKeys(all_indicator_confidence_alt2)

										loadfpForOneStudentAlt2(ist_id, sorted_all_attendance_confidence_alt2, sorted_all_indicator_confidence_alt2, fp_array, attendances_mobile_pc)

										// ********** ALTERNATIVE 3 - Equal to original but if values changes compares to see if has found that value before *******
										let s_pc_alt3 = null
										let s_mobile_alt3 = null
										if (fp_pc.length > 0)
											s_pc_alt3 = await fpAlternativeOriginalPlusCheckPrevious(fp_pc)
										if (fp_mobile.length > 0)
											s_mobile_alt3 = await fpAlternativeOriginalPlusCheckPrevious(fp_mobile)

										// combine pc & mobile alternative 2
										let all_attendance_confidence_alt3 = {}
										let all_indicator_confidence_alt3 = {}
										let all_weight_attendance_alt3 = {}
										if (s_pc_alt3) {
											for (let k of Object.keys(s_pc_alt3['attendance_confidence'])) {
												all_attendance_confidence_alt3[k] = s_pc_alt3['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_pc_alt3['attendance_indicator_flag'])) {
												all_indicator_confidence_alt3[k] = s_pc_alt3['attendance_indicator_flag'][k]
											}
											for (let k of Object.keys(s_pc_alt3['array_weight_attendance'])) {
												all_weight_attendance_alt3[k] = s_pc_alt3['array_weight_attendance'][k]
											}
										}
										if (s_mobile_alt3) {
											for (let k of Object.keys(s_mobile_alt3['attendance_confidence'])) {
												all_attendance_confidence_alt3[k] = s_mobile_alt3['attendance_confidence'][k]
											}
											for (let k of Object.keys(s_mobile_alt3['attendance_indicator_flag'])) {
												all_indicator_confidence_alt3[k] = s_mobile_alt3['attendance_indicator_flag'][k]
											}
											for (let k of Object.keys(s_mobile_alt3['array_weight_attendance'])) {
												all_weight_attendance_alt3[k] = s_mobile_alt3['array_weight_attendance'][k]
											}
										}

										let sorted_all_attendance_confidence_alt3 = sortOnKeys(all_attendance_confidence_alt3)
										let sorted_all_indicator_confidence_alt3 = sortOnKeys(all_indicator_confidence_alt3)
										let sorted_all_weight_attendance_alt3= sortOnKeys(all_weight_attendance_alt3)

										getConfidenceWeight(function() {
											loadfpForOneStudentAlt3(ist_id, sorted_all_attendance_confidence_alt3, sorted_all_indicator_confidence_alt3, fp_array, sorted_all_weight_attendance_alt3, attendances_mobile_pc)
										});
									}

								}

								if (last_attendace_id === 'pc')
									callback(s_pc['general_confidence'])
								else if (last_attendace_id === 'mobile')
									callback(s_mobile['general_confidence'])
								else
									callback('undefined')

							} else {
								console.log("Error loading getAllFingerprint:", this.status);
							}
						}
					};
					xhttp.open("GET", url, true);
					xhttp.send();

				} else {
					console.log("Error getFixedWeight:", this.status);
				}
			}
		};
		xhttp_fixed.open("GET", '/api/getfixedFingerprintWeight?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp_fixed.send();


	}

	function calculateFPWeightForAllIndicators(data) {
		let array = {
			"languages": [],
			"colorDepth": [],
			"deviceMemory": [],
			"hardwareConcurrency": [],
			"screenResolution": [],
			'availableScreenResolution': [],
			"sessionStorage": [],
			"localStorage": [],
			"platform": [],
			"plugins": [],
			"pixelDepth": [],
			"adBlock": [],
			"fonts": [],
			"audio": [],
			"gpu": [],
			'useragent': [],
			'ip': []
		};
		let array_weight = {};
		let array_attendance_flags = {}
		let array_attendance_confidence = {}


		for (let el of Object.keys(fixedFingerprintWeight)) {
			array_weight['' + el] = [0]
		}


		let sum_max_fixedWeight = 0
		for (let k of Object.keys(array)) {
			sum_max_fixedWeight += fixedFingerprintWeight[k];
			for (let i = 0; i < data.length; ++i) {
				array[k].push(data[i][k])
			}
		}

		for (let k of Object.keys(array)) {
			for (let i = 1; i < data.length; ++i) {
				let w = 0;
				if (data[i - 1][k] !== data[i][k]) {
					w = fixedFingerprintWeight[k];
				}
				let avgWeightIndicator = (array_weight[k][i - 1] + w) / 2
				array_weight[k].push(avgWeightIndicator)
			}
		}

		let array_weight_attendance = {}
		for (let i = 0; i < data.length; ++i) {
			array_weight_attendance[data[i].attendanceID] = []
			for (let k of Object.keys(array_weight)) {
				array_weight_attendance[data[i].attendanceID].push(array_weight[k][i])
			}
		}
		for (let i = 0; i < data.length; ++i) {
			array_attendance_flags[data[i].attendanceID] = []
		}
		for (let k of Object.keys(array)) {
			array_attendance_flags[data[0].attendanceID].push(false)
		}

		array_attendance_confidence[data[0].attendanceID] = ['ok', 1.000]
		for (let i = 1; i < data.length; ++i) {
			let sum_ind = 0
			for (let k of Object.keys(array)) {
				sum_ind += array_weight[k][i];
			}

			let conf = normalize(sum_ind, sum_max_fixedWeight, 0)
			conf = 1-conf
			let status_attendance = []
			if (conf >= thresh_ok) {
				status_attendance.push('ok')
			} else if (conf < thresh_ok && conf > thresh_fail) {
				status_attendance.push('meh')
			} else if (conf <= thresh_fail) {
				status_attendance.push('failed')
			}
			status_attendance.push(conf.toFixed(3))
			array_attendance_confidence[data[i].attendanceID] = status_attendance
		}

		return {
			'general_confidence': array_attendance_confidence[Object.keys(array_attendance_confidence)[Object.keys(array_attendance_confidence).length - 1]],
			'attendance_confidence': array_attendance_confidence,
			'attendance_indicator_flag': array_attendance_flags,
			'array_weight_attendance': array_weight_attendance
		}
	}
	
	function normalize(val, max, min) { return (val - min) / (max - min); }

	function sortOnKeys(dict) {
		let sorted = [];
		for(let key in dict) {
			sorted[sorted.length] = key;
		}
		sorted.sort((a, b) => a - b);

		let tempDict = {};
		for(let i = 0; i < sorted.length; i++) {
			tempDict[sorted[i]] = dict[sorted[i]];
		}

		return tempDict;
	}

	function fpAlternativeOriginalPlusCheckPrevious(data){
		let array = {
			"languages": [],
			"colorDepth": [],
			"deviceMemory": [],
			"hardwareConcurrency": [],
			"screenResolution": [],
			'availableScreenResolution': [],
			"sessionStorage": [],
			"localStorage": [],
			"platform": [],
			"plugins": [],
			"pixelDepth": [],
			"adBlock": [],
			"fonts": [],
			"audio": [],
			"gpu": [],
			'useragent': [],
			'ip': []
		};
		let array_weight = {};
		let array_attendance_flags = {}
		let array_attendance_confidence = {}


		for (let el of Object.keys(fixedFingerprintWeight)) {
			array_weight['' + el] = [0]
		}

		let sum_max_fixedWeight = 0
		for (let k of Object.keys(array)) {
			sum_max_fixedWeight += fixedFingerprintWeight[k];
			for (let i = 0; i < data.length; ++i) {
				array[k].push(data[i][k])
			}
		}

		for (let k of Object.keys(array)) {
			for (let i = 1; i < data.length; ++i) {
				let w = 0;
				if (data[i - 1][k] !== data[i][k]) {
					if (array[k].indexOf(data[i][k]) > -1 && array[k].indexOf(data[i][k]) < i){
						let pos_og = array[k].lastIndexOf(data[i][k])
						let pos = array[k].lastIndexOf(data[i][k], array[k].lastIndexOf(data[i][k])-1)

						w = fixedFingerprintWeight[k] * ((pos_og-pos)/pos_og)
					} else if (array[k].indexOf(data[i][k]) > -1) {
						w = fixedFingerprintWeight[k];
					}
				}
				let avgWeightIndicator = (array_weight[k][i - 1] + w) / 2
				array_weight[k].push(avgWeightIndicator)
			}
		}

		let array_weight_attendance = {}
		for (let i = 0; i < data.length; ++i) {
			array_weight_attendance[data[i].attendanceID] = []
			for (let k of Object.keys(array_weight)) {
				array_weight_attendance[data[i].attendanceID].push(array_weight[k][i])
			}
		}
		for (let i = 0; i < data.length; ++i) {
			array_attendance_flags[data[i].attendanceID] = []
		}
		for (let k of Object.keys(array)) {
			array_attendance_flags[data[0].attendanceID].push(false)
		}

		array_attendance_confidence[data[0].attendanceID] = ['ok', 1.000]
		for (let i = 1; i < data.length; ++i) {
			let sum_ind = 0
			for (let k of Object.keys(array)) {
				sum_ind += array_weight[k][i];
			}

			let conf = normalize(sum_ind, 0, sum_max_fixedWeight)
			let status_attendance = []
			if (conf >= 1-thresh_ok) {
				status_attendance.push('ok')
			} else if (conf < 1-thresh_ok && conf > 1-thresh_fail) {
				status_attendance.push('meh')
			} else if (conf <= 1-thresh_fail) {
				status_attendance.push('failed')
			}
			status_attendance.push(conf.toFixed(3))
			array_attendance_confidence[data[i].attendanceID] = status_attendance
		}

		return {
			'attendance_confidence': array_attendance_confidence,
			'attendance_indicator_flag': array_attendance_flags,
			'array_weight_attendance': array_weight_attendance
		}
	}

	function fpAlternativeCompWithPrevious(data){
		let array = {"languages":[], "colorDepth":[], "deviceMemory":[], "hardwareConcurrency":[], "screenResolution":[],'availableScreenResolution':[],
			"sessionStorage":[], "localStorage":[], "platform":[], "plugins":[],"pixelDepth":[], "adBlock":[], "fonts":[], "audio":[],
			"gpu":[], 'useragent':[],'ip':[]};

		let numberIndicat = Object.keys(array).length
		let array_attendance_flags = {}
		let array_attendance_confidence = {}

		for (let k of Object.keys(array)){
			for (let i = 0; i < data.length; ++i){
				array[k].push(data[i][k])
			}
		}

		/* for each student table */
		for (let i = 0; i < data.length; ++i) {
			array_attendance_flags[data[i].attendanceID] = []
		}
		for (let k of Object.keys(array)) {
			array_attendance_flags[data[0].attendanceID].push(false)
		}

		for (let i = 1; i < data.length; ++i) {
			for (let k of Object.keys(array)) {
				if (array[k][i-1] && array[k][i]) {
					if (array[k][i - 1] !== array[k][i]) {
						array_attendance_flags[data[i].attendanceID].push(true)
					} else {
						array_attendance_flags[data[i].attendanceID].push(false)
					}
				} else {
					array_attendance_flags[data[i].attendanceID].push(null)
				}
			}
		}

		for (let i = 0; i < Object.keys(array_attendance_flags).length; ++i) {
			if (i === 0) array_attendance_confidence[Object.keys(array_attendance_flags)[i]] = ['ok',1.000]
			else {
				let count_true = array_attendance_flags[Object.keys(array_attendance_flags)[i]].filter(Boolean).length;
				let status_attendance = []
				if (Number(count_true) >= (Number(numberIndicat) * thresh_ok)) {
					status_attendance.push('failed') //failed
				} else if (Number(count_true) > (Number(numberIndicat) * thresh_fail) && Number(count_true) < (Number(numberIndicat) * thresh_ok)) {
					status_attendance.push('meh') //meh
				} else if (Number(count_true) <= (Number(numberIndicat) * thresh_fail)){
					status_attendance.push('ok') //ok
				}
				status_attendance.push(normalize(Number(count_true), 0, Number(numberIndicat)).toFixed(3))

				array_attendance_confidence[Object.keys(array_attendance_flags)[i]] = status_attendance
			}
		}

		/* for students table */
		let count = 0;
		for (let k of Object.keys(array)){
			if (array[k][data.length-2]){
				if (array[k][data.length-2] !== array[k][data.length-1]) count++;
			}
		}

		return {'attendance_confidence': array_attendance_confidence, 'attendance_indicator_flag':array_attendance_flags}
	}

	function fpAlternativeCompWithMostFrequent(data){
		let array = {"languages":[], "colorDepth":[], "deviceMemory":[], "hardwareConcurrency":[], "screenResolution":[],'availableScreenResolution':[],
			"sessionStorage":[], "localStorage":[], "platform":[], "plugins":[],"pixelDepth":[], "adBlock":[], "fonts":[], "audio":[],
			"gpu":[], 'useragent':[],'ip':[]};
		let array_mostfrequent = {"languages":'', "colorDepth":'', "deviceMemory":'', "hardwareConcurrency":'', "screenResolution":'','availableScreenResolution':'',
			"sessionStorage":'', "localStorage":'', "platform":'', "plugins":'',"pixelDepth":'', "adBlock":'', "fonts":'', "audio":'',
			"gpu":'', 'useragent':'','ip':''};

		let numberIndicat = Object.keys(array).length
		let array_attendance_flags = {}
		let array_attendance_confidence = {}

		for (let k of Object.keys(array)){
			for (let i = 0; i < data.length; ++i){
				array[k].push(data[i][k])
			}
			array_mostfrequent[k] = mode(array[k])
		}


		/* for each student table */
		for (let i = 0; i < data.length; ++i) {
			array_attendance_flags[data[i].attendanceID] = []
		}
		for (let k of Object.keys(array)) {
			array_attendance_flags[data[0].attendanceID].push(false)
		}

		for (let i = 1; i < data.length; ++i) {
			for (let k of Object.keys(array)) {
				if (array[k][i]) {
					if (array[k][i] !== array_mostfrequent[k]) {
						array_attendance_flags[data[i].attendanceID].push(true)
					} else {
						array_attendance_flags[data[i].attendanceID].push(false)
					}
				} else {
					array_attendance_flags[data[i].attendanceID].push(null)
				}
			}
		}

		for (let i = 0; i < Object.keys(array_attendance_flags).length; ++i) {
			if (i === 0) array_attendance_confidence[Object.keys(array_attendance_flags)[i]] = ['ok',1.000]
			else {
				let count_true = array_attendance_flags[Object.keys(array_attendance_flags)[i]].filter(Boolean).length;
				let status_attendance = []
				if (Number(count_true) >= (Number(numberIndicat) * thresh_fail)) {
					status_attendance.push('failed') //failed
				} else if (Number(count_true) > (Number(numberIndicat) * thresh_ok) && Number(count_true) < (Number(numberIndicat) * thresh_fail)) {
					status_attendance.push('meh') //meh
				} else if (Number(count_true) <= (Number(numberIndicat) * thresh_ok)){
					status_attendance.push('ok') //ok
				}
				status_attendance.push(normalize(Number(count_true), 0, Number(numberIndicat)).toFixed(3))


				array_attendance_confidence[Object.keys(array_attendance_flags)[i]] = status_attendance
			}
		}

		/* for students table */
		let count = 0;
		for (let k of Object.keys(array)){
			if (array[k][data.length-2]){
				if (array[k][data.length-2] !== array[k][data.length-1]) count++;
			}
		}

		return {'attendance_confidence': array_attendance_confidence, 'attendance_indicator_flag':array_attendance_flags}
	}

	function mode(array){
		if(array.length === 0) return null;
		let modeMap = {};
		let maxEl = array[0], maxCount = 1;
		for(let i = 0; i < array.length; i++)
		{
			let el = array[i];
			if(modeMap[el] == null)
				modeMap[el] = 1;
			else
				modeMap[el]++;
			if(modeMap[el] > maxCount)
			{
				maxEl = el;
				maxCount = modeMap[el];
			}
		}
		return maxEl;
	}


	function getLocationStatus(courseID, classcounter, callback) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let st = JSON.parse(this.responseText);
					let table = document.getElementById("studentsTable");
					let rows = table.rows
					let alredyInserted = []
					for (let i = 1; i < rows.length; ++i) {
						for (let k of Object.keys(st).reverse()) {
							for (let j = 0; j < st[k].length; ++j) {
								if (st[k][j]['ist_id'] === rows[i].cells[0].innerText && !alredyInserted.includes(rows[i].cells[0].innerText)) {
									if (st[k][j]['location-flag'] === 5 || st[k][j]['location-flag'] === 4 || st[k][j]['location-flag'] === 3) {
										rows[i].cells[6].getElementsByTagName('img')[1].src = "/img/placeholder_ok.svg"
									} else if (st[k][j]['location-flag'] === 2) {
										rows[i].cells[6].getElementsByTagName('img')[1].src = "/img/placeholder_maybe.svg"
									} else if (st[k][j]['location-flag'] === 0 || st[k][j]['location-flag'] === 1) {
										rows[i].cells[6].getElementsByTagName('img')[1].src = "/img/placeholder_failed.svg"
									} else if (st[k][j]['location-flag'] === -1) {
										rows[i].cells[6].getElementsByTagName('img')[1].src = "/img/placeholder.svg"
									}
									alredyInserted.push(rows[i].cells[0].innerText)


									if (st[k][j]['location-flag'] === 0) {
										rows[i].cells[6].setAttribute('value_gps', '0')
									} else if (st[k][j]['location-flag'] === 1) {
										rows[i].cells[6].setAttribute('value_gps', '0.2')
									} else if (st[k][j]['location-flag'] === 2) {
										rows[i].cells[6].setAttribute('value_gps', '0.4')
									} else if (st[k][j]['location-flag'] === 3) {
										rows[i].cells[6].setAttribute('value_gps', '0.6')
									} else if (st[k][j]['location-flag'] === 4) {
										rows[i].cells[6].setAttribute('value_gps', '0.8')
									} else if (st[k][j]['location-flag'] === 5) {
										rows[i].cells[6].setAttribute('value_gps', '1')
									}

								}
							}
						}
					}
					if (callback) callback();
				}
			}
		}
		xhttp.open("GET", '/api/getAllLocationData?c='+courseID+'&s='+currentShift+'&cl='+classcounter, true);
		xhttp.send();
	}

	function removeTrs(old_tr, num=1, leaveEnd=0) {
		for(let l = old_tr.length-1-leaveEnd; l > num-1; l--) {
			old_tr[l].parentElement.removeChild(old_tr[l]);
		}
	}

	function showStudents(studentshistory, classcounter, title) {
		let rows = studentshistory.rows;

		rows.sort(function(a, b) {
			return a.attendanceID - b.attendanceID;
		});

		let students_rows = [];
		let aux = [];
		aux.push(rows[0])
		for (let i = 1; i < rows.length; ++i) {
			if (rows[i].attendanceID !== rows[i-1].attendanceID){
				students_rows.push(aux);
				aux = [];
				aux.push(rows[i]);
			} else {
				aux.push(rows[i]);
			}
		}
		students_rows.push(aux)
		rows = students_rows;

		let t = document.getElementById("studentsTable");
		let r = t.rows.length;
		for (let j = r-1; j > 0; j--) {
			t.deleteRow(j);
		}
		let attendanceDiv = document.getElementById("attendanceDiv")
		attendanceDiv.style.visibility = "hidden"

		attendanceDiv.style.visibility = "visible"
		let template = document.getElementById("studentsTemplate");
		let table = document.getElementById("studentsTable");
		let template_tried = document.getElementById("attempedstudentsTemplate");
		let table_tried = document.getElementById("attempedstudentsTable");
		//let button_edit = document.getElementById("editButton");
		removeTrs(table.getElementsByTagName("tr"));
		removeTrs(table_tried.getElementsByTagName("tr"));
		let rows_studentsThatTried = studentshistory.rows_studentsThatTried;
		table.courseID = courseID;
		table.classcounter = classcounter;
		table_tried.classcounter = classcounter;
		table.title = title;

		//clear columns that are from other pages and are extra
		if (table.rows[0].cells.length > 6+rows.length){
			for (let i = table.rows[0].cells.length-1; i > 7; --i){
				table.rows[0].cells[i].remove()
			}
		}

		if (rows.length > 1) {
			document.getElementById('late_checkbox_span').style.display = 'none'
		} else {
			document.getElementById('late_checkbox_span').style.display = 'inline-block'
		}
		// add new columns for attendance
		let tBody = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0];
		for (let x = 1; x < rows.length; ++x){
			if(!existsAtt(tBody, x+1)){
				let th_new = document.createElement('th');
				th_new.innerHTML ='Attendance #'+(x+1)
				th_new.id = 'att'+(x+1)
				th_new.style.cursor='not-allowed';
				tBody.append(th_new)
			}
		}

		getStudentStatus(function(status) {
			aux_addStudents(table, template, rows, status, function(){
				getLocationStatus(courseID, document.getElementById("currentClass").innerText, function(){
					loadStudentsFP('/api/getattendancefp', document.getElementById("currentClass").innerText)
				})
			})
		})

		for(let i = 0; i < rows.length; ++i) {
			for (let j = 0; j < rows[i].length; ++j) {
				for (let x = 0; x < rows_studentsThatTried.length; ++x){
					if (rows_studentsThatTried[x]['ist_id'] === rows[i][j]['ist_id'] && rows_studentsThatTried[x]['numberAttendance'] === rows[i][j]['numberAttendance']){
						rows_studentsThatTried.splice(x,1);
					}
				}
			}
		}

		if(rows_studentsThatTried.length > 0) {
			table.parentElement.classList.add("historycolumn");
			document.getElementById("attempedstudentsDiv").style.display = "";
			for(let j = 0; j < rows_studentsThatTried.length; j++) {
				addStudentTried(table_tried, template_tried, rows_studentsThatTried[j].ist_id, rows_studentsThatTried[j].name, rows_studentsThatTried[j].numberAttendance);
			}
		} else {
			document.getElementById("attempedstudentsDiv").style.display = "none";
			table.parentElement.classList.remove("historycolumn");
		}

		/*for form to add student */
		let total_attendance = (table.rows[0].cells.length - 7)
		let select_attendance = document.getElementById('attendanceTable')
		select_attendance.innerHTML = ''
		for(let i = 1; i <= total_attendance; ++i) {
			let option = document.createElement('option')
			option.setAttribute('value', i)
			let option_text = document.createTextNode(i)
			option.appendChild(option_text)
			select_attendance.appendChild(option)
		}
	}

	function aux_addStudents(table, template, rows, status, callback){
		for (let i = 0; i < rows.length; ++i) {
			for (let j = 0; j < rows[i].length; j++) {
				addStudent(table, template, rows[i][j].ist_id, rows[i][j].name, (rows[i][j].late === 1), false, false, false, i, rows.length, status);
			}
		}

		callback();
	}

	function existsAtt(tbody, attN){
		let c = tbody.getElementsByTagName('th')
		for (let i = 8; i < c.length; ++i){
			if (c[i].id === ('att'+attN)){
				return true;
			}
		}
		return false;
	}

	function isIn(rows, ist_id) {
		for(let x = 0; x < rows.length; x++) {
			if(rows[x].ist_id === ist_id) {
				return true;
			}
		}
		return false;
	}

	function ifExists(table, ist_id){
		for (let i = 0; i < table.rows.length; ++i){
			if (table.rows[i].cells[0].innerText === ist_id && table.rows[i].cells[0].innerText !== 'IST ID'){
				return [true, table.rows[i]]
			}
		}
		return [false]
	}
	function addStudentTried(table, template, ist_id, name, attendanceNumber) {
		let tr_clone;
		let tds;
		tr_clone = template.content.querySelector("tr").cloneNode(true);
		tds = tr_clone.children;
		tr_clone.ist_id = ist_id;
		tr_clone.std_name = name;
		tr_clone.attendanceN = '#'+attendanceNumber;
		tr_clone.style.textAlign='center'

		for(let x = 0; x < tds.length - 1; x++) {
			tds[x].innerText = arguments[x+2];
		}

		table.appendChild(tr_clone);

	}


	function addStudent(table, template, ist_id, name, late, manually, studentCheating, isTableTried, numberAttendance, totalAttendances, status) {
		let existsTr = ifExists(table, ist_id)
		let tr_clone;
		let tds;

		if (!existsTr[0]) {
			tr_clone = template.content.querySelector("tr").cloneNode(true);
			tds = tr_clone.children;
			tr_clone.ist_id = ist_id;
			tr_clone.std_name = name;
			tr_clone.onclick = function (){
				getAllLocation('/api/getAllLocationData?cl=' + document.getElementById('currentClass').innerText + '&c=' + courseID + '&s=' + currentShift, ist_id)
			}

			if(studentCheating){
				tr_clone.classList.add("less_suspicious");
			}

			if(isTableTried === true) {
				for(let x = 0; x < tds.length - 1; x++) {
					tds[x].innerText = arguments[x+2];
				}
			} else {
				tds[0].innerText = ist_id
				tds[1].innerText = name
			}
		} else {
			tr_clone = existsTr[1]
			tds = tr_clone.children
		}

		/* add to all rows the same columns of attendance */
		if (totalAttendances) {
			if (tds.length < 7+totalAttendances){
				for (let x = 8; x < (7+totalAttendances); ++x){ // 7 number of already existing collumns
					let tds_new = document.createElement('td');
					tr_clone.appendChild(tds_new);
				}
			}

			tds[7+numberAttendance].innerHTML = '<img src="/img/check.svg" class="img-button" alt="">' //attendance #1
			if (late) tds[7+numberAttendance].innerHTML = tds[7+numberAttendance].innerHTML + '<img src="/img/late.svg" class="img-button" alt="">'
			tds[7+numberAttendance].className = 'checked';
			tds[7+numberAttendance].style.textAlign = 'center';
		}

		if (!existsTr[0]) {
			let tds_delete = document.createElement('td');
			tds_delete.innerHTML = '<button><img src="/img/lupa.svg" className="img-button" width="20px" style="float: left"></button><button type="button" onClick="manuallyRemoveStudent(this)"><img src="/img/delete.svg" className="img-button" width="20px" style="float: left"></button>'
			tr_clone.appendChild(tds_delete);
		}


		table.appendChild(tr_clone);


		// for complete,  aux
		let aux_att = []
		for (let x = 7; x < 7+totalAttendances; ++x) { // 7 index where attendances start
			if (tds[x].classList.contains('checked')){
				aux_att.push(true)
			} else {
				aux_att.push(false)
			}
		}


			let totalAttendance
			let specificAttendance
			if (status.totalComplete && status.specificComplete) {
				totalAttendance = status.totalComplete.toString()
				specificAttendance = (status.specificComplete.includes(',') ? status.specificComplete.split(',') : [status.specificComplete])
			} else { // if undefined, complete default is all attendances
				totalAttendance = totalAttendances
				specificAttendance = Array.from({length: totalAttendances}, (_, i) => i + 1)
			}

			let specificEarly
			if (status.specificEarly){
				specificEarly = (status.specificEarly.includes(',') ? status.specificEarly.split(',') : [status.specificEarly])
			} else {
				specificEarly = [totalAttendances]
			}

			let specificLate
			if (status.specificLate){
				specificLate = (status.specificLate.includes(',') ? status.specificLate.split(',') : [status.specificLate])
			} else {
				specificLate = [1]
			}


			let trueAttendances = aux_att.filter(c => c === true).length;

			let state = 'complete'

			let aux_late = true
			for (let x = 0; x < specificLate.length; ++x) {
				if (aux_att[parseInt(specificLate[x])-1] === true) {
					aux_late = false;
				}
			}

			let aux_early = true
			for (let x = 0; x < specificEarly.length; ++x) {
				if (aux_att[parseInt(specificEarly[x])-1] === true) {
					aux_early = false;
				}
			}
			if (aux_early && aux_late) state = 'middle'
			else if (aux_early) state = 'early'
			else if (aux_late) state = 'late'

			let fail = false
			if (state !== 'complete') {
				for (let x = 0; x < aux_att.length; ++x) {
					if (trueAttendances >= totalAttendance) {
						if (specificAttendance.includes((x+1).toString())) {
							if (aux_att[x] === false) fail = true;
						}
					} else {
						fail = true;
					}
				}
			}

			if (state !== 'complete' && fail === false) {
				state = 'complete'
			}


			/* clear state columns */
			tds[2].innerHTML = ''
			tds[3].innerHTML = ''
			tds[4].innerHTML = ''
			tds[5].innerHTML = ''

			/* populate state columns */
			if (state === 'complete'){
				tds[2].innerHTML = '<span class="dot"></span>'
				tds[2].style.textAlign = 'center';
			} else if (state === 'late') {
				tds[3].innerHTML = '<span class="dot"></span>'
				tds[3].style.textAlign = 'center';
			} else if (state === 'early') {
				tds[4].innerHTML = '<span class="dot"></span>'
				tds[4].style.textAlign = 'center';
			} else if (state === 'middle'){
				tds[5].innerHTML = '<span class="dot"></span>'
				tds[5].style.textAlign = 'center';
			}


			//update status in db
			updateStatusForStudent('/api/updateStatusForStudent', document.getElementById('currentClass').innerText, courseID, currentShift, ist_id, state)

	}

	function clearTT(table){
		let tableHeaderRowCount = 1;
		let rowCount = table.rows.length;
		for (let i = tableHeaderRowCount; i < rowCount; i++) {
			table.deleteRow(tableHeaderRowCount);
		}
	}

	function manuallyRemoveShift(shift_uid) {
		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			removeShift('/api/manuallyRemoveShift', shift_uid);
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to remove this shift from this course?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function manuallyRemoveStudent(btn) {
		let ist_id = btn.closest('tr').cells[0].innerText;
		let currentClass = document.getElementById("currentClass").innerText;


		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			removeStudent('/api/manuallyRemoveStudent?i='+ist_id+'&cl='+currentClass+'&c='+courseID+'&s='+currentShift, btn, currentClass);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to remove this students from this class?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function updateClass(classNumber, remove, new_cl, new_title, event) {
		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			if (remove)
				removeAttendance('/api/manuallyRemoveAttendance?a='+classNumber+'&c='+courseID+'&s='+currentShift, classNumber);
			else
				updateAttendance('/api/manuallyUpdateAttendance?a='+classNumber+'&c='+courseID+'&s='+currentShift+'&new_cl='+new_cl+'&new_title='+new_title, classNumber);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you add this course to the attendance list?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);

		event.preventDefault();
	}

	function manuallyUpdateClass(btn, class_row){
		let class_table = document.getElementById('historyTable')

		let rows = class_table.rows
		let editRow
		let editRowIndex
		let allClassNumber = []
		for (let i = 1; i < rows.length; ++i) { // no th
			allClassNumber.push(rows[i].cells[0].innerText)
			if (class_row && class_row.cells[0].innerText === rows[i].cells[0].innerText){
				editRow = rows[i]
				editRowIndex = i
			}
		}
		let backup_class = class_table.rows[editRowIndex].cells[0].innerHTML
		let backup_title = class_table.rows[editRowIndex].cells[1].innerHTML
		let backup_btn = class_table.rows[editRowIndex].cells[11].innerHTML


		class_table.rows[editRowIndex].cells[0].innerHTML = ''
		class_table.rows[editRowIndex].cells[1].innerHTML = ''
		class_table.rows[editRowIndex].cells[11].innerHTML = ''


		let updateClassForm = document.createElement('form')
		updateClassForm.setAttribute('id', 'updateClass')

		/* number */
		let classNumber = document.createElement('input')
		classNumber.setAttribute('name', 'classNumber')
		classNumber.setAttribute('type', 'number')
		classNumber.setAttribute('value', backup_class)
		updateClassForm.appendChild(classNumber)
		/* title */
		let classTitle = document.createElement('input')
		classTitle.setAttribute('name', 'classTitle')
		classTitle.setAttribute('type', 'text')
		classTitle.setAttribute('form', 'updateClass')
		classTitle.setAttribute('value', backup_title)

		/* buttons */
		let btn_update = document.createElement('button')
		btn_update.onclick = function() {
			let new_class_number = classNumber.value
			let new_title = classTitle.value
			if (!allClassNumber.includes(new_class_number)  || new_class_number.toString() === backup_class.toString())
				updateClass(backup_class, false, new_class_number, new_title, event)
			else
				return false;
		}
		let update_text = document.createTextNode('Update')
		btn_update.appendChild(update_text)

		let btn_cancel = document.createElement('button')
		btn_cancel.onclick = function(){
			class_table.rows[editRowIndex].cells[0].innerText = backup_class
			class_table.rows[editRowIndex].cells[1].innerText = backup_title
			class_table.rows[editRowIndex].cells[11].innerHTML = backup_btn
		}
		let cancel_text = document.createTextNode('Cancel')
		btn_cancel.appendChild(cancel_text)


		class_table.rows[editRowIndex].cells[0].appendChild(updateClassForm)
		class_table.rows[editRowIndex].cells[1].appendChild(classTitle)
		class_table.rows[editRowIndex].cells[11].appendChild(btn_update)
		class_table.rows[editRowIndex].cells[11].appendChild(btn_cancel)


		for (let i = 0; i < class_table.rows[editRowIndex].cells.length; ++i) { // no th
			class_table.rows[editRowIndex].cells[i].onclick = function(){return false;}

		}
	}

	function removeAttendance(url, attendanceID) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					//button_element.disabled=true;
					loadHistory(courseID,null,currentShift,currentCampus);
					switchView(0);
				} else {
					console.log("Error removing attendance:", this.status);
					myAlert("<strong>Error</strong> removing attendance. Try again please.")
				}
			}
		};
		xhttp.open("POST", url, true);
		xhttp.send(JSON.stringify({}));
	}


	function updateStatusForStudent(url, currentClass, courseID, shiftID, ist_id, state){
		let json = {}
		json.currentClass = currentClass;
		json.courseID = courseID;
		json.shiftID = shiftID;
		json.ist_id = ist_id;
		json.state = state;
		let json_string = JSON.stringify(json);

		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {

				} else {
					console.log("Error updateStatusForStudent:", this.status);
				}
			}
		};
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function updateAttendance(url) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					loadHistory(courseID,null,currentShift,currentCampus);
					switchView(0);
				} else {
					console.log("Error removing attendance:", this.status);
					myAlert("<strong>Error</strong> removing attendance. Try again please.")
				}
			}
		};
		xhttp.open("POST", url, true);
		xhttp.send(JSON.stringify({}));
	}

	function showLink(element, event) {

		prompt("Copy the link:", element.href);
		event.preventDefault();
	}

	function removeShift(url, shiftID){

		let o = {};
		o.shift_id = shiftID;
		let json_string = JSON.stringify(o);
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if (this.status === 200) {
					removeShiftForm_after();
				} else {
					console.log("Error removing shift:", this.status);
					myAlert("<strong>Error</strong> removing shift. Try again please.")
				}
			}
		};
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function removeStudent(url, button_element, currentClass) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					button_element.disabled=true;
					let attendanceID = JSON.parse(this.responseText)

					// to reload the page
					loadStudents('/api/getattendancehistory?rid='+attendanceID, currentClass);
					currentAttendanceID = attendanceID
					switchView(1)

				} else {
					console.log("Error removing student:", this.status);
					myAlert("<strong>Error</strong> removing student. Try again please.")
				}
			}
		};
		xhttp.open("GET", url, true);
		xhttp.send();
	}

	function sendForm(){
		let formEl = document.getElementById("formStudent");
		let data = new FormData(formEl);
		let o = {};
		let select = document.getElementById("attendanceTable");
		let attendanceCheck = select.options[select.selectedIndex].value;

		o.attendanceNumber = attendanceCheck;
		o.classNumber = document.getElementById('currentClass').innerText
		o.courseID = courseID
		o.shiftID = currentShift

		for(let e of data) {
			if (e[0] === 'ist_id'){
				if (e[1].toLowerCase().includes("ist1")){
					if (e[1].length < 9 || e[1].length > 10) { //ist1 + XXXXX || ist1 + YYYYYY
						myAlert("Invalid student number")
						return;
					}
				} else {
					if (e[1].length != 9){ //ist4 + XXXXX
						myAlert("Invalid student number")
						return;
					}
				}
			}
			o[e[0]] = e[1];
		}

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {
			let xhttp = new XMLHttpRequest();
			let url = "/api/addmanually";
			xhttp.onreadystatechange = function() {
				if(this.readyState === 4 && this.status === 200) {
					let attendanceID = JSON.parse(this.responseText);
					let classcounter = document.getElementById('currentClass').innerText;

					let inputadd_student = document.getElementById("inputadd_student");
					inputadd_student.value = "";
					loadStudents('/api/getattendancehistory?rid='+attendanceID, classcounter);
				}
			};

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to add this course?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function loadisLate(url, json, td) {

		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					if(td.innerText === "X") {
						td.classList.remove("toRed");
						td.classList.add("toGreen");
						td.innerHTML = "&#10004;";
					} else {
						td.classList.remove("toGreen");
						td.classList.add("toRed");
						td.innerHTML = "X";
					}
				} else {
					console.log("Error loading isLate", this.status);

					myAlert("Could not change student's status.")
				}
			}
		};
		let json_string = JSON.stringify(json);
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function loadShifts() {

		let url = "/api/loadshifts";

		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {

					loadShiftsByCourseID();
					document.getElementById("shiftOn").style.display = "";
					document.getElementById("invisible-info-shifts").style.display = "none";
				} else {
				}
			}
		};

		json = {};
		json.courseID = courseID;
		let json_string = JSON.stringify(json);
		xhttp.open("POST", url, true);
		xhttp.send(json_string);
	}

	function copyISTIDToAddStudent(button) {

		let inputadd_student = document.getElementById("inputadd_student");
		inputadd_student.value = button.parentElement.parentElement.ist_id;

		let attendanceTable = document.getElementById("attendanceTable");
		attendanceTable.value = button.parentElement.parentElement.childNodes[5].innerText;
		sendForm();
	}

	function switchView(arg){

		switch(arg) {
			case -1:
				loadShiftsByCourseID();
				document.getElementById("showShifts").style.display = "";
				document.getElementById("showHistoryofProfessor").style.display = "none";
				document.getElementById("showStudentsHistory").style.display = "none";
				document.getElementById("btn-create-att").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "none";
				if (document.getElementById("tsv_export_shift_by_secret")) {
					document.getElementById("tsv_export_shift_by_secret").id = 'tsv_export_by_secret'
					document.getElementById("tsv_export_by_secret").href = tsv_course;
				}
				break;
			case 0:
				document.getElementById('btn-config').style.display = "none";
				document.getElementById('btn-indWeights').style.display = "none";
				document.getElementById("showShifts").style.display = "none";
				document.getElementById("showHistoryofProfessor").style.display = "";
				document.getElementById("showStudentsHistory").style.display = "none";
				document.getElementById("btn-create-att").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "none";
				if (document.getElementById("tsv_export_by_secret")) {
					document.getElementById("tsv_export_by_secret").id = 'tsv_export_shift_by_secret'
				}
				if (document.getElementById("tsv_export_class_by_secret")) {
					document.getElementById("tsv_export_class_by_secret").id = 'tsv_export_shift_by_secret'
					document.getElementById("tsv_export_shift_by_secret").href = tsv_shifts;
				}
				break;
			case 1:
				document.getElementById('btn-config').style.display = "";
				document.getElementById('btn-indWeights').style.display = "";
				document.getElementById('btn-stStatus').style.display = "";
				document.getElementById('btn-confWeight').style.display = "none";
				document.getElementById('btn-confThresh').style.display = "none";
				document.getElementById("altfpdiv").style.display = "none";
				document.getElementById("showShifts").style.display = "none";
				document.getElementById("showHistoryofProfessor").style.display = "none";
				document.getElementById("showStudentsHistory").style.display = "";
				document.getElementById("btn-create-att").style.display = "";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "none";
				if (document.getElementById("tsv_export_shift_by_secret")) {
					document.getElementById("tsv_export_shift_by_secret").id = 'tsv_export_class_by_secret'
					document.getElementById("tsv_export_class_by_secret").href = tsv_classes;
				}
				break;
			case 2:
				document.getElementById('btn-stStatus').style.display = "none";
				document.getElementById('btn-confWeight').style.display = "";
				document.getElementById('btn-confThresh').style.display = "";
				document.getElementById("showShifts").style.display = "none";
				document.getElementById("showHistoryofProfessor").style.display = "none";
				document.getElementById("showStudentsHistory").style.display = "none";
				document.getElementById("btn-create-att").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "none";
				document.getElementsByClassName('currentClassStat')[0].innerText = document.getElementById("currentClass").innerText;
				break;
			case 4:
				document.getElementById('btn-stStatus').style.display = "none";
				document.getElementById('btn-confWeight').style.display = "";
				document.getElementById('btn-confThresh').style.display = "";
				document.getElementById("showShifts").style.display = "none";
				document.getElementById("showHistoryofProfessor").style.display = "none";
				document.getElementById("showStudentsHistory").style.display = "none";
				document.getElementById("btn-create-att").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "";
				document.getElementById("altfpdiv").style.display = "";
				document.getElementById("studentsFP-alt").style.display = "none";
				break;
			case 5:
				document.getElementById('btn-stStatus').style.display = "none";
				getAllLocation('/api/getAllLocationData?cl=' + document.getElementById('currentClass').innerText + '&c=' + courseID + '&s=' + currentShift, document.getElementById('currentStudent').innerText, true)
				document.getElementById("showShifts").style.display = "none";
				document.getElementById("showHistoryofProfessor").style.display = "none";
				document.getElementById("showStudentsHistory").style.display = "none";
				document.getElementById("btn-create-att").style.display = "none";
				document.getElementById("showFingerprintHistory").style.display = "none";
				document.getElementById("showStats").style.display = "none";
				document.getElementById("studentsFP").style.display = "";
				document.getElementById("studentsFP-alt").style.display = "";
				break;
			default:
				console.log("unknown arg", arg);
				break;
		}
	}

	loadName("/api/name");
	loadProfessorsByCourse(courseID);
	loadShiftsByCourseID();

	function myAlert(text) {
		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("alert");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("closebtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = '×';

		div.innerHTML = text;

		div.appendChild(spanCancel);
		document.body.appendChild(div);
	}


	function myDropFunction(dropTable) {
		if(document.getElementById(dropTable).classList.length === 1)
			document.getElementById(dropTable).classList.toggle("show");
		else
			document.getElementById(dropTable).classList.remove("show");
	}

	function classIsRemote(classN) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let remote = JSON.parse(this.responseText);
					let isremote = false;

					for (let i =  0; i < remote.length; ++i){
						if (remote[i]['remote'] === 1){
							isremote = true;
							continue;
						}
					}

					if (isremote) { 
						document.getElementById('gpscoordtables').style.display = "";
						getStudentsCoords(classN);
					}

				} else {
					console.log("Error getting if class is remote:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/isremote?cl='+classN+'&c='+courseID+'&s='+currentShift, true);
		xhttp.send();
	}

	function getStudentsCoords(classN) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let coords = JSON.parse(this.responseText);

				} else {
					console.log("Error getting if class is remote:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/getStudentCoords?cl='+classN, true);
		xhttp.send();
	}

	function loadStudentsFP(url, classcounter, callback) {
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = async function () {
			if (this.readyState === 4) {
				if (this.status === 200) {
					let studentsfp = JSON.parse(this.responseText);
					let st = {}
					if (studentsfp.length > 0) {
						for (let i = studentsfp.length - 1; i >= 0; --i) {
							if (!st[studentsfp[i]['ist_id']]) {
								st[studentsfp[i]['ist_id']] = studentsfp[i]['confidence'];
							}
						}
					}

					let table = document.getElementById("studentsTable");
					let rows = table.rows
					for (let i = 1; i < rows.length; ++i) {
						getAllFingerprint('/api/getAllFingerprintData?cl=' + classcounter + '&c=' + courseID + '&s=' + currentShift + '&sid=' + rows[i].cells[0].innerText, rows[i].cells[0].innerText,
								false, null, false, function (s) {
									if (s[0] === 'ok') rows[i].cells[6].getElementsByTagName('img')[0].src = "/img/fingerprint_ok.svg"
									else if (s[0] === 'meh') rows[i].cells[6].getElementsByTagName('img')[0].src = "/img/fingerprint_maybe.svg"
									else if (s[0] === 'failed') rows[i].cells[6].getElementsByTagName('img')[0].src = "/img/fingerprint_failed.svg"
									else rows[i].cells[6].getElementsByTagName('img')[0].src = "/img/fingerprint.svg"
									rows[i].cells[6].setAttribute('value_fp', s[1])

									getConfidenceWeight(function(){
										loadConfidenceForStudentsOverview(rows[i].cells[0].innerText, rows[i])
									})


								})
					}

				} else {
					console.log("Error loading students fp :", this.status);
				}
			}
		};
		xhttp.open("GET", url+'?cl='+classcounter+'&c='+courseID+'&s='+currentShift, true);
		xhttp.send();
	}

	function loadConfidenceForStudentsOverview(ist_id, r){
		let table = document.getElementById('studentsTable')
		let rows = table.rows

		for (let i = 0; i < rows.length; ++i){
			if (table.rows[i].cells[0].innerText === ist_id){
				let conf = ''
				let conf_value = 0

				let gps = (table.rows[i].cells[6].getAttribute('value_gps') ? Number(table.rows[i].cells[6].getAttribute('value_gps')):-1);
				let fp = (table.rows[i].cells[6].getAttribute('value_fp') ? Number(table.rows[i].cells[6].getAttribute('value_fp')):-1);

				if (gps !== -1){
					if(fp !== -1){
						conf_value = (gps*confidenceWeight['gps'] + fp*confidenceWeight['fp']).toFixed(3)
					}
					else conf = '-1'
				} else {
					if (fp !== -1) {
						conf_value = Number(fp).toFixed(3)
					}
					else conf = '-1'
				}

				if (conf_value <= thresh_fail) r.cells[6].getElementsByTagName('img')[2].src = '/img/square_failed.svg'
				else if (conf_value < thresh_ok && conf_value > thresh_fail) r.cells[6].getElementsByTagName('img')[2].src = '/img/square_maybe.svg'
				else if (conf_value >= thresh_ok) r.cells[6].getElementsByTagName('img')[2].src = '/img/square_ok.svg'

				break;
			}
		}
	}

	function loadfpForOneStudent(ist_id, studentfp, allindconf, fp_array, weight_per_attendance, attendance_mobile_pc, location){
		document.getElementById('currentStudent').innerText = ist_id

		let listAttendances = []
		let fpLst = []
		let locationLst = []
		//--------------------- for fingerprint ---------------------
		{
			let stConf = document.getElementById('studentsConfidenceTable')
			let stConfTem = document.getElementById('studentsConfidenceTemplate')
			let stConfBody = document.getElementById('studentsConfidenceBody')
			clearTT(stConf)

			stConfBody.innerHTML = ''
			let body = document.importNode(stConfTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Fingerprint'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			th_conf.onclick = function () {
				let div = document.getElementById('studentsFPDiv')
				if (div.style.display === 'none') div.style.display = ''
				else div.style.display = 'none'
			}
			body.appendChild(th_conf)

			for (let k of Object.keys(studentfp)) {
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')
				td.setAttribute('value', studentfp[k][1])

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')
				span.innerText = 'AttendanceID #'+ k + '\nConfidence: '+studentfp[k][1]
				td.appendChild(span)
				listAttendances.push(k)
				fpLst.push(studentfp[k][0])
				if (studentfp[k][0] === 'failed') {
					td.style.backgroundColor = '#D81616'
				} else if (studentfp[k][0] === 'meh') {
					td.style.backgroundColor = '#F0B92B'
				} else if (studentfp[k][0] === 'ok') {
					td.style.backgroundColor = '#2E8036'
				} else {
					td.style.backgroundColor = '#A4A4A4'
				}
				body.appendChild(td)
			}
			stConfBody.appendChild(body);
		}

		//--------------------- for all indicators ---------------------
		{
			let indicatorsListDisplay = ["Languages", "Color Depth", "Device Memory", "Hardware Concurrency", "Screen Resolution","Available Screen Resolution",
				"Session Storage", "Local Storage", "Platform", "Plugins", "Color Resolution", "AdBlock", "Fonts", "Audio", "GPU", "User-Agent","IP"]
			let indicatorsList = ["languages", "colorDepth", "deviceMemory", "hardwareConcurrency", "screenResolution",'availableScreenResolution',
				"sessionStorage", "localStorage", "platform", "plugins","pixelDepth", "adBlock", "fonts", "audio", "gpu", "useragent","ip"]
			let stFp = document.getElementById('studentsFPTable')
			let stFpTem = document.getElementById('studentsFPTemplate')
			let stFpBody = document.getElementById('studentsFPBody')
			clearTT(stFp)

			// cabecalhos
			let cloneTable = stFp.childNodes[1].childNodes[1]
			cloneTable.innerHTML = ''
			let th = document.createElement('td')
			th.setAttribute('class', 'headerStat')
			th.innerText = 'Indicator'
			th.style.width = '230px'
			cloneTable.appendChild(th)

			for (let j = 0; j < Object.keys(allindconf).length; j++){
				let th = document.createElement('td')
				if (attendance_mobile_pc[j] === 'mobile'){
					th.innerHTML = "<img src='/img/phone.svg' className='img-button' width='20px'>"
				} else {
					th.innerHTML = "<img src='/img/laptop.svg' className='img-button' width='20px'>"
				}

				cloneTable.appendChild(th)
			}

			// corpo
			let clone = document.importNode(stFpTem.content, true);
			let attendance_keys = Object.keys(allindconf)

			for (let i = 0; i < allindconf[attendance_keys[0]].length; ++i){
				let tr = document.createElement('tr')
				let td_ind = document.createElement('td')
				td_ind.innerText = indicatorsListDisplay[i]
				tr.appendChild(td_ind)

				for (let j = 0; j < attendance_keys.length; j++){
					let td = document.createElement('td')
					td.style.width = '20px'
					td.setAttribute('class', 'tooltip')
					let span = document.createElement('span')
					span.setAttribute('class', 'tooltiptext')
					span.innerText = fp_array[indicatorsList[i]][j]
					td.appendChild(span)
					tr.appendChild(td)

					if (weight_per_attendance[attendance_keys[j]][i] === null) td.style.backgroundColor = '#A4A4A4'
					else {
						let initial_values = []
						for (let el of Object.keys(fixedFingerprintWeight)){
							initial_values.push(fixedFingerprintWeight[''+el])
						}
						if (weight_per_attendance[attendance_keys[j]][i] >= ((4/5) * initial_values[i])) {
							td.style.backgroundColor = '#D81616'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((4/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((3/5) * initial_values[i])){
							td.style.backgroundColor = '#FB7E0B'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((3/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((2/5) * initial_values[i])) { // meh
							td.style.backgroundColor = '#F0B92B'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((2/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((1/5) * initial_values[i])) { // okay
							td.style.backgroundColor = '#79D878'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((1/5) * initial_values[i])) { // more okay
							td.style.backgroundColor = '#2E8036'
						}
					}
					tr.appendChild(td)
				}
				clone.appendChild(tr);
			}
			stFpBody.appendChild(clone);
		}

		//--------------------- for location ---------------------
		{
			let stLocal = document.getElementById('studentsLocationTable')
			let stLocalTem = document.getElementById('studentsLocationTemplate')
			let stLocalBody = document.getElementById('studentsLocationBody')
			clearTT(stLocal)

			stLocalBody.innerHTML = ''
			let body = document.importNode(stLocalTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Geolocation'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			body.appendChild(th_conf)

			for (let i = 0; i < listAttendances.length; ++i){
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')


				if (listAttendances[i] in location){
					for (let st = 0; st < location[listAttendances[i]].length; ++st){
						if (location[listAttendances[i]][st].ist_id === ist_id){

							if (location[listAttendances[i]][st]['location-flag'] === 0 || location[listAttendances[i]][st]['location-flag'] === 1) {
								td.style.backgroundColor = '#D81616'
								locationLst.push('failed')
							} else if (location[listAttendances[i]][st]['location-flag'] === 2) {
								td.style.backgroundColor = '#F0B92B'
								locationLst.push('meh')
							} else if (location[listAttendances[i]][st]['location-flag'] === 5 || location[listAttendances[i]][st]['location-flag'] === 4 || location[listAttendances[i]][st]['location-flag'] === 3) {
								td.style.backgroundColor = '#2E8036'
								locationLst.push('ok')
							} else {
								td.style.backgroundColor = '#A4A4A4'
								span.innerText = 'No value.'
								locationLst.push('-1')
							}

							if (location[listAttendances[i]][st]['location-flag'] === 0){
								td.setAttribute('value', '0')
							} else if (location[listAttendances[i]][st]['location-flag'] === 1){
								td.setAttribute('value', '0.2')
							} else if (location[listAttendances[i]][st]['location-flag'] === 2){
								td.setAttribute('value', '0.4')
							} else if (location[listAttendances[i]][st]['location-flag'] === 3){
								td.setAttribute('value', '0.6')
							} else if (location[listAttendances[i]][st]['location-flag'] === 4){
								td.setAttribute('value', '0.8')
							} else if (location[listAttendances[i]][st]['location-flag'] === 5){
								td.setAttribute('value', '1')
							} else {
								td.setAttribute('value', '0')
							}

							span.innerText = 'Accuracy of '+ location[listAttendances[i]][st].accur + 'm.' +'\nConfidence on GPS: '+td.getAttribute('value')
							td.appendChild(span)
						}
					}
				} else {
					span.innerText = 'No value.'
					td.appendChild(span)
					td.style.backgroundColor = '#A4A4A4'
				}
				body.appendChild(td)
			}
			stLocalBody.appendChild(body);
		}

		//--------------------- for final confidence ---------------------
		{
			let stLocal = document.getElementById('studentsFinalConfidenceTable')
			let stLocalTem = document.getElementById('studentsFinalConfidenceTemplate')
			let stLocalBody = document.getElementById('studentsFinalConfidenceBody')
			clearTT(stLocal)

			stLocalBody.innerHTML = ''
			let body = document.importNode(stLocalTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Confidence'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			body.appendChild(th_conf)

			for (let i = 1; i <= listAttendances.length; ++i){
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')

				let conf = ''
				if (locationLst[i] !== '-1'){
					let gps = document.getElementById('studentsLocationBody').children
					let fp = document.getElementById('studentsConfidenceBody').children

					let conf_value = 0
					if(gps[i].getAttribute('value') && fp[i].getAttribute('value')){
						conf_value = (Number(gps[i].getAttribute('value'))*confidenceWeight['gps'] + Number(fp[i].getAttribute('value'))*confidenceWeight['fp']).toFixed(3)
					}

					span.innerText = 'Confidence value: '+conf_value

					if (conf_value <= thresh_fail) conf = 'failed'
					else if (conf_value < thresh_ok && conf_value > thresh_fail) conf = 'meh'
					else if (conf_value >= thresh_ok) conf = 'ok'
					else conf = 'unknown'

				} else {
					if (fpLst[i] !== null) {
						let fp = document.getElementById('studentsConfidenceBody').children
						let conf_value = 0
						if(fp[i].getAttribute('value'))
							conf_value = Number(fp[i].getAttribute('value')).toFixed(3)

						span.innerText = 'Confidence value: '+conf_value

						if (conf_value <= thresh_fail) conf = 'failed'
						else if (conf_value < thresh_ok && conf_value > thresh_fail) conf = 'meh'
						else if (conf_value <= thresh_ok) conf = 'ok'
						else conf = 'unknown'
					}
					else conf = '-1'
				}

				td.appendChild(span)
				if (conf === 'failed') {
					td.style.backgroundColor = '#D81616'
				} else if (conf === 'meh') {
					td.style.backgroundColor = '#F0B92B'
				} else if (conf === 'ok') {
					td.style.backgroundColor = '#2E8036'
				} else {
					td.style.backgroundColor = '#A4A4A4'
					span.innerText = 'No value.'
				}

				body.appendChild(td)
			}

			stLocalBody.appendChild(body);
		}
	}

	function loadfpForOneStudentAlt3(ist_id, studentfp, allindconf, fp_array,weight_per_attendance, attendance_mobile_pc){

		document.getElementById('currentStudent').innerText = ist_id

		let listAttendances = []
		let fpLst = []
		//--------------------- for fingerprint ---------------------
		{
			let stConf = document.getElementById('studentsConfidenceTable-alt3')
			let stConfTem = document.getElementById('studentsConfidenceTemplate-alt3')
			let stConfBody = document.getElementById('studentsConfidenceBody-alt3')
			clearTT(stConf)

			stConfBody.innerHTML = ''
			let body = document.importNode(stConfTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Fingerprint'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			th_conf.onclick = function () {
				let div = document.getElementById('studentsFPDiv-alt3')
				if (div.style.display === 'none') div.style.display = ''
				else div.style.display = 'none'
			}
			body.appendChild(th_conf)

			for (let k of Object.keys(studentfp)) {
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')
				td.setAttribute('value', studentfp[k][1])

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')
				//span.innerText = 'AttendanceID #'+ k + '\nConfidence: '+studentfp[k][1]
				span.innerText = 'Confidence: '+studentfp[k][1]
				td.appendChild(span)
				listAttendances.push(k)
				fpLst.push(studentfp[k][0])
				if (studentfp[k][0] === 'failed') {
					td.style.backgroundColor = '#D81616'
				} else if (studentfp[k][0] === 'meh') {
					td.style.backgroundColor = '#F0B92B'
				} else if (studentfp[k][0] === 'ok') {
					td.style.backgroundColor = '#2E8036'
				} else {
					td.style.backgroundColor = '#A4A4A4'
				}
				body.appendChild(td)
			}
			stConfBody.appendChild(body);
		}

		//--------------------- for all indicators ---------------------
		{
			let indicatorsListDisplay = ["Languages", "Color Depth", "Device Memory", "Hardware Concurrency", "Screen Resolution","Available Screen Resolution",
				"Session Storage", "Local Storage", "Platform", "Plugins", "Color Resolution", "AdBlock", "Fonts", "Audio", "GPU", "User-Agent","IP"]
			let indicatorsList = ["languages", "colorDepth", "deviceMemory", "hardwareConcurrency", "screenResolution",'availableScreenResolution',
				"sessionStorage", "localStorage", "platform", "plugins","pixelDepth", "adBlock", "fonts", "audio", "gpu", "useragent","ip"]
			let stFp = document.getElementById('studentsFPTable-alt3')
			let stFpTem = document.getElementById('studentsFPTemplate-alt3')
			let stFpBody = document.getElementById('studentsFPBody-alt3')
			clearTT(stFp)

			// cabecalhos
			let cloneTable = stFp.childNodes[1].childNodes[1]
			cloneTable.innerHTML = ''
			let th = document.createElement('td')
			th.setAttribute('class', 'headerStat')
			th.innerText = 'Indicator'
			th.style.width = '230px'
			cloneTable.appendChild(th)

			for (let j = 0; j < Object.keys(allindconf).length; j++){
				let th = document.createElement('td')
				if (attendance_mobile_pc[j] === 'mobile'){
					th.innerHTML = "<img src='/img/phone.svg' className='img-button' width='20px'>"
				} else {
					th.innerHTML = "<img src='/img/laptop.svg' className='img-button' width='20px'>"
				}

				cloneTable.appendChild(th)
			}

			// corpo
			let clone = document.importNode(stFpTem.content, true);
			let attendance_keys = Object.keys(allindconf)

			for (let i = 0; i < allindconf[attendance_keys[0]].length; ++i){
				let tr = document.createElement('tr')
				let td_ind = document.createElement('td')
				td_ind.innerText = indicatorsListDisplay[i]
				tr.appendChild(td_ind)

				for (let j = 0; j < attendance_keys.length; j++){
					let td = document.createElement('td')
					td.style.width = '20px'
					td.setAttribute('class', 'tooltip')
					let span = document.createElement('span')
					span.setAttribute('class', 'tooltiptext')
					span.innerText = fp_array[indicatorsList[i]][j]
					td.appendChild(span)
					tr.appendChild(td)

					if (weight_per_attendance[attendance_keys[j]][i] === null) td.style.backgroundColor = '#A4A4A4'
					else {
						let initial_values = []
						for (let el of Object.keys(fixedFingerprintWeight)){
							initial_values.push(fixedFingerprintWeight[''+el])
						}
						if (weight_per_attendance[attendance_keys[j]][i] >= ((4/5) * initial_values[i])) {
							td.style.backgroundColor = '#D81616'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((4/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((3/5) * initial_values[i])){
							td.style.backgroundColor = '#FB7E0B'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((3/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((2/5) * initial_values[i])) { // meh
							td.style.backgroundColor = '#F0B92B'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((2/5) * initial_values[i]) && weight_per_attendance[attendance_keys[j]][i] >= ((1/5) * initial_values[i])) { // okay
							td.style.backgroundColor = '#79D878'
						} else if (weight_per_attendance[attendance_keys[j]][i] < ((1/5) * initial_values[i])) { // more okay
							td.style.backgroundColor = '#2E8036'
						}
					}
					tr.appendChild(td)
				}
				clone.appendChild(tr);
			}
			stFpBody.appendChild(clone);
		}
	}


	function loadfpForOneStudentAlt1(ist_id, studentfp, allindconf, fp_array, attendance_mobile_pc){
		document.getElementById('currentStudent').innerText = ist_id

		let listAttendances = []
		//--------------------- for confidence ---------------------
		{
			let stConf = document.getElementById('studentsConfidenceTable-alt1')
			let stConfTem = document.getElementById('studentsConfidenceTemplate-alt1')
			let stConfBody = document.getElementById('studentsConfidenceBody-alt1')
			clearTT(stConf)

			stConfBody.innerHTML = ''
			let body = document.importNode(stConfTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Fingerprint'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			th_conf.onclick = function () {
				let div = document.getElementById('studentsFPDiv')
				if (div.style.display === 'none') div.style.display = ''
				else div.style.display = 'none'
			}
			body.appendChild(th_conf)

			for (let k of Object.keys(studentfp)) {
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')
				//span.innerText = 'AttendanceID #'+ k + '\nConfidence: '+studentfp[k][1]
				span.innerText = 'Confidence: '+studentfp[k][1]
				td.appendChild(span)
				listAttendances.push(k)

				if (studentfp[k][0] === 'failed') {
					td.style.backgroundColor = '#D81616'
				} else if (studentfp[k][0] === 'meh') {
					td.style.backgroundColor = '#F0B92B'
				} else if (studentfp[k][0] === 'ok') {
					td.style.backgroundColor = '#2E8036'
				} else {
					td.style.backgroundColor = '#A4A4A4'
				}
				body.appendChild(td)
			}
			stConfBody.appendChild(body);
		}

		//--------------------- for all indicators ---------------------
		{
			let indicatorsListDisplay = ["Languages", "Color Depth", "Device Memory", "Hardware Concurrency", "Screen Resolution","Available Screen Resolution",
				"Session Storage", "Local Storage", "Platform", "Plugins", "Color Resolution", "AdBlock", "Fonts", "Audio", "GPU", "User-Agent","IP"]
			let indicatorsList = ["languages", "colorDepth", "deviceMemory", "hardwareConcurrency", "screenResolution",'availableScreenResolution',
				"sessionStorage", "localStorage", "platform", "plugins","pixelDepth", "adBlock", "fonts", "audio", "gpu", "useragent","ip"]
			let stFp = document.getElementById('studentsFPTable-alt1')
			let stFpTem = document.getElementById('studentsFPTemplate-alt1')
			let stFpBody = document.getElementById('studentsFPBody-alt1')
			clearTT(stFp)

			// cabecalhos
			let cloneTable = stFp.childNodes[1].childNodes[1]
			cloneTable.innerHTML = ''
			let th = document.createElement('td')
			th.setAttribute('class', 'headerStat')
			th.innerText = 'Indicator'
			th.style.width = '230px'
			cloneTable.appendChild(th)

			for (let j = 0; j < Object.keys(allindconf).length; j++){
				let th = document.createElement('td')
				if (attendance_mobile_pc[j] === 'mobile'){
					th.innerHTML = "<img src='/img/phone.svg' className='img-button' width='20px'>"
				} else {
					th.innerHTML = "<img src='/img/laptop.svg' className='img-button' width='20px'>"
				}

				cloneTable.appendChild(th)
			}

			// corpo
			let clone = document.importNode(stFpTem.content, true);
			let attendance_keys = Object.keys(allindconf)

			for (let i = 0; i < allindconf[attendance_keys[0]].length; ++i){
				let tr = document.createElement('tr')
				let td_ind = document.createElement('td')
				td_ind.innerText = indicatorsListDisplay[i]
				tr.appendChild(td_ind)

				for (let j = 0; j < attendance_keys.length; j++){
					let td = document.createElement('td')
					td.style.width = '20px'
					td.setAttribute('class', 'tooltip')
					let span = document.createElement('span')
					span.setAttribute('class', 'tooltiptext')
					span.innerText = fp_array[indicatorsList[i]][j]
					td.appendChild(span)
					tr.appendChild(td)

					if (allindconf[attendance_keys[j]][i] === null) td.style.backgroundColor = '#A4A4A4'
					else {
						if (i === 0) td.style.backgroundColor = '#2E8036'
						else if (allindconf[attendance_keys[j]][i] === true) {
							td.style.backgroundColor = '#D81616'
						} else if (allindconf[attendance_keys[j]][i] === false) {
							td.style.backgroundColor = '#2E8036'
						}
					}
					tr.appendChild(td)
				}
				clone.appendChild(tr);
			}
			stFpBody.appendChild(clone);
		}
	}

	function loadfpForOneStudentAlt2(ist_id, studentfp, allindconf, fp_array, attendance_mobile_pc){
		document.getElementById('currentStudent').innerText = ist_id

		let listAttendances = []
		//--------------------- for confidence ---------------------
		{
			let stConf = document.getElementById('studentsConfidenceTable-alt2')
			let stConfTem = document.getElementById('studentsConfidenceTemplate-alt2')
			let stConfBody = document.getElementById('studentsConfidenceBody-alt2')
			clearTT(stConf)

			stConfBody.innerHTML = ''
			let body = document.importNode(stConfTem.content, true);
			let th_conf = document.createElement('td')
			th_conf.setAttribute('class', 'headerStat')
			th_conf.innerText = 'Fingerprint'
			th_conf.style.cursor = 'pointer'
			th_conf.style.width = '230px'
			th_conf.onclick = function () {
				let div = document.getElementById('studentsFPDiv')
				if (div.style.display === 'none') div.style.display = ''
				else div.style.display = 'none'
			}
			body.appendChild(th_conf)

			for (let k of Object.keys(studentfp)) {
				let td = document.createElement('td')
				td.style.width = '28px'
				td.setAttribute('class', 'tooltip')

				let span = document.createElement('span')
				span.setAttribute('class', 'tooltiptext')
				span.innerText = 'Confidence: '+studentfp[k][1]
				td.appendChild(span)
				listAttendances.push(k)

				if (studentfp[k][0] === 'failed') {
					td.style.backgroundColor = '#D81616'
				} else if (studentfp[k][0] === 'meh') {
					td.style.backgroundColor = '#F0B92B'
				} else if (studentfp[k][0] === 'ok') {
					td.style.backgroundColor = '#2E8036'
				} else {
					td.style.backgroundColor = '#A4A4A4'
				}
				body.appendChild(td)
			}
			stConfBody.appendChild(body);
		}

		//--------------------- for all indicators ---------------------
		{
			let indicatorsListDisplay = ["Languages", "Color Depth", "Device Memory", "Hardware Concurrency", "Screen Resolution","Available Screen Resolution",
				"Session Storage", "Local Storage", "Platform", "Plugins", "Color Resolution", "AdBlock", "Fonts", "Audio", "GPU", "User-Agent","IP"]
			let indicatorsList = ["languages", "colorDepth", "deviceMemory", "hardwareConcurrency", "screenResolution",'availableScreenResolution',
				"sessionStorage", "localStorage", "platform", "plugins","pixelDepth", "adBlock", "fonts", "audio", "gpu", "useragent","ip"]
			let stFp = document.getElementById('studentsFPTable-alt2')
			let stFpTem = document.getElementById('studentsFPTemplate-alt2')
			let stFpBody = document.getElementById('studentsFPBody-alt2')
			clearTT(stFp)

			// cabecalhos
			let cloneTable = stFp.childNodes[1].childNodes[1]
			cloneTable.innerHTML = ''
			let th = document.createElement('td')
			th.setAttribute('class', 'headerStat')
			th.innerText = 'Indicator'
			th.style.width = '230px'
			cloneTable.appendChild(th)

			for (let j = 0; j < Object.keys(allindconf).length; j++){
				let th = document.createElement('td')
				if (attendance_mobile_pc[j] === 'mobile'){
					th.innerHTML = "<img src='/img/phone.svg' className='img-button' width='20px'>"
				} else {
					th.innerHTML = "<img src='/img/laptop.svg' className='img-button' width='20px'>"
				}

				cloneTable.appendChild(th)
			}

			// corpo
			let clone = document.importNode(stFpTem.content, true);
			let attendance_keys = Object.keys(allindconf)

			for (let i = 0; i < allindconf[attendance_keys[0]].length; ++i){
				let tr = document.createElement('tr')
				let td_ind = document.createElement('td')
				td_ind.innerText = indicatorsListDisplay[i]
				tr.appendChild(td_ind)

				for (let j = 0; j < attendance_keys.length; j++){
					let td = document.createElement('td')
					td.style.width = '20px'
					td.setAttribute('class', 'tooltip')
					let span = document.createElement('span')
					span.setAttribute('class', 'tooltiptext')
					span.innerText = fp_array[indicatorsList[i]][j]
					td.appendChild(span)
					tr.appendChild(td)

					if (allindconf[attendance_keys[j]][i] === null) td.style.backgroundColor = '#A4A4A4'
					else {
						if (i === 0) td.style.backgroundColor = '#2E8036'
						else if (allindconf[attendance_keys[j]][i] === true) {
							td.style.backgroundColor = '#D81616'
						} else if (allindconf[attendance_keys[j]][i] === false) {
							td.style.backgroundColor = '#2E8036'
						}
					}
					tr.appendChild(td)
				}
				clone.appendChild(tr);
			}
			stFpBody.appendChild(clone);
		}
	}

	var confidenceWeight = {'fp': 0.5, 'gps':0.5}
	function getConfidenceWeight(callback){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let percent = JSON.parse(this.responseText)
					if (percent.length > 0) {
						confidenceWeight['fp'] = percent[percent.length-1]['fp_percentage']/100
						confidenceWeight['gps'] = percent[percent.length-1]['gps_percentage']/100
					}

					document.getElementById('fp_gps_percent').value = confidenceWeight['gps']*100
					if (callback) callback();
				} else {
					console.log("Error getConfidenceWeight:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/getConfidenceWeight?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp.send();
	}

	function updateSearchStudentListForm(studentHistory){
		let ist_ids = {}
		for (let i = 0; i < studentHistory.length; ++i){
			if (!(studentHistory[i]['ist_id'] in ist_ids)){
				ist_ids[studentHistory[i]['ist_id']] = studentHistory[i]['name']
			}
		}
		let ul = document.getElementById('searchStudentListForm');
		ul.innerHTML='';

		ul.style.width = '200px';
		ul.style.display = 'none';
		ul.style.position = 'fixed';
		ul.style.bottom = '40px';
		ul.style.left = '23px'
		ul.style.borderRadius = '15px 15px 0px 0px'

		for (let st in ist_ids){
			let li = document.createElement('li');
			let a = document.createElement('a');
			a.setAttribute('href', '#');
			a.style.color = 'black';
			a.style.marginTop = '-1px';
			a.style.textDecoration = 'none';
			a.innerText = st + ' - ' + ist_ids[st];
			a.onclick = function(){
				hideStudentsNumbers(this)
			}
			a.setAttribute('id', st);
			li.appendChild(a);
			ul.appendChild(li);
		}
	}

	function searchStudentList() {
		// Declare variables
		let input, filter, ul, li, a, i, txtValue;
		input = document.getElementById('inputadd_student');
		filter = input.value.toUpperCase();
		ul = document.getElementById("searchStudentListForm");
		li = ul.getElementsByTagName('li');

		// Loop through all list items, and hide those who don't match the search query
		for (i = 0; i < li.length; i++) {
			a = li[i].getElementsByTagName("a")[0];
			txtValue = a.textContent || a.innerText;
			if (txtValue.toUpperCase().indexOf(filter) > -1) {
				li[i].style.display = "";
			} else {
				li[i].style.display = "none";
			}
		}
	}

	function showStudentsNumbers() {
		let checkboxes = document.getElementById("searchStudentListForm");
		checkboxes.style.display = "block";
	}

	function hideStudentsNumbers(elem){
		document.getElementById('inputadd_student').value = elem.id;

		let checkboxes = document.getElementById("searchStudentListForm");
		checkboxes.style.display = "none";
	}

	function configStudentStatus(){
		getStudentStatus(function(status){
			if (status.totalComplete && status.specificComplete && status.specificEarly && status.specificLate){
				populateOptionsStatus(status.totalComplete.toString(), (status.specificComplete.includes(',') ? status.specificComplete.split(',') : status.specificComplete), (status.specificEarly.includes(',') ? status.specificEarly.split(',') : [status.specificEarly]), (status.specificLate.includes(',') ? status.specificLate.split(',') : [status.specificLate]))
			} else if (status.totalComplete && status.specificComplete && status.specificEarly){
				populateOptionsStatus(status.totalComplete.toString(), (status.specificComplete.includes(',') ? status.specificComplete.split(',') : status.specificComplete), (status.specificEarly.includes(',') ? status.specificEarly.split(',') : [status.specificEarly]))
			} else if (status.totalComplete && status.specificComplete && status.specificLate){
				populateOptionsStatus(status.totalComplete.toString(), (status.specificComplete.includes(',') ? status.specificComplete.split(',') : status.specificComplete), null, (status.specificLate.includes(',') ? status.specificLate.split(',') : [status.specificLate]))
			} else if (status.totalComplete && status.specificComplete) {
				populateOptionsStatus(status.totalComplete.toString(), (status.specificComplete.includes(',') ? status.specificComplete.split(',') : status.specificComplete))
			} else {
				populateOptionsStatus()
			}
		})

		let div = document.getElementById('configStatusDiv')
		if (div.classList.contains('hidden')) div.setAttribute('class', 'center')
		else div.setAttribute('class', 'center hidden')
	}

	function updateStudentStatus(){
		let formEl = document.getElementById("updateStudentStatus");
		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}
		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			if (e[0] === 'specificAttendance' || e[0] === 'specificLate' || e[0] === 'specificEarly') {
				if (typeof(o[e[0]]) === "object")
					o[e[0]].push(parseInt(e[1]))
				else {
					o[e[0]] = []
					o[e[0]].push(parseInt(e[1]))
				}
			} else {
				o[e[0]] = parseInt(e[1]);
			}
		}

		o.courseID = courseID;
		o.shiftID = currentShift;
		o.classNumber = document.getElementById('currentClass').innerText;

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {

			let xhttp = new XMLHttpRequest();
			let url = "/api/updateStudentStatus";
			xhttp.onreadystatechange = function () {
				if (this.readyState === 4 && this.status === 200) {
					formEl.reset();
					document.getElementById('configStatusDiv').setAttribute('class', 'center hidden')
					let currentClass = document.getElementById("currentClass").innerText;
					loadStudents("/api/getattendancehistory?rid="+currentAttendanceID, currentClass);
				}
			}

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to update?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function updateFixedThresh(){
		let formEl = document.getElementById("updateThresh");
		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}
		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			o[e[0]] = e[1];
		}

		o.courseID = courseID;
		o.shiftID = currentShift;
		o.classNumber = document.getElementById('currentClass').innerText;

		let json_string = JSON.stringify(o);
		console.log(json_string)

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {

			let xhttp = new XMLHttpRequest();
			let url = "/api/updateFixedThresh";
			xhttp.onreadystatechange = function () {
				if (this.readyState === 4 && this.status === 200) {
					updatefixedFingerprintWeight_after();
					document.getElementById('configStatusDiv').setAttribute('class', 'center hidden')
				}
			}

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to update?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function defaultFixedThresh(){
		let formEl = document.getElementById("updateThresh");
		formEl.reset();
		updateFixedThresh();
	}

	function cancelFixedThresh(){
		let xhttp_fixed = new XMLHttpRequest();
		xhttp_fixed.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let thresh = JSON.parse(this.responseText);
					if (thresh.length > 0) {
						document.getElementById('fail_thresh').value = Number(thresh['failed'])
						document.getElementById('ok_thresh').value = Number(thresh['ok'])
						document.getElementById('fail_thresh').nextElementSibling.value =  Number(thresh['failed'])/100
						document.getElementById('ok_thresh').nextElementSibling.value = Number(thresh['ok'])/100
					} else {
						document.getElementById('fail_thresh').value = 81
						document.getElementById('ok_thresh').value = 90
						document.getElementById('fail_thresh').nextElementSibling.value = 0.81
						document.getElementById('ok_thresh').nextElementSibling.value = 0.90
					}

				} else {
					console.log("Error getFixedThresh:", this.status);
				}
			}
		};
		xhttp_fixed.open("GET", '/api/getFixedThresh?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp_fixed.send();
	}

	function getFixedThresh(callback){
		let xhttp_fixed = new XMLHttpRequest();
		xhttp_fixed.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let thresh = JSON.parse(this.responseText);
					if (thresh.length > 0) {
						thresh_ok = Number(thresh['ok'])
						thresh_fail = Number(thresh['failed'])
					}
					callback();
				} else {
					console.log("Error getFixedThresh:", this.status);
				}
			}
		};
		xhttp_fixed.open("GET", '/api/getFixedThresh?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp_fixed.send();
	}

	function cancelFixedWeight(){
		let xhttp_fixed = new XMLHttpRequest();
		xhttp_fixed.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let ind = ['useragent', 'ip', 'languages', 'colorDepth',
						'deviceMemory', 'hardwareConcurrency', 'screenResolution',
						'availableScreenResolution', 'sessionStorage', 'localStorage',
						'platform', 'plugins', 'fonts', 'audio', 'gpu', 'adBlock', 'pixelDepth']
					let new_ind = JSON.parse(this.responseText);
					if (new_ind !== null) {
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = new_ind[i];
						})
					} else {
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = ind_default[i];
						})
					}

					ind.forEach(function(i){
						document.getElementById(i).value = fixedFingerprintWeight[i]
					})

				} else {
					console.log("Error getFixedWeight:", this.status);
				}
			}
		};
		xhttp_fixed.open("GET", '/api/getfixedFingerprintWeight?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp_fixed.send();

	}

	function defaultFixedWeights(){
		let formEl = document.getElementById("updateFixedWeight");
		formEl.reset();
		updateFixedWeights();
	}

	function updateFixedWeights(){
		let formEl = document.getElementById("updateFixedWeight");
		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}
		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			if (e[0] === 'type_update') o[e[0]] = e[1];
			else o[e[0]] = parseInt(e[1]);
		}

		o.courseID = courseID;
		o.shiftID = currentShift;
		o.classNumber = document.getElementById('currentClass').innerText;

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {

			let xhttp = new XMLHttpRequest();
			let url = "/api/updateFixedWeight";
			xhttp.onreadystatechange = function () {
				if (this.readyState === 4 && this.status === 200) {
					updatefixedFingerprintWeight_after();
					document.getElementById('configStatusDiv').setAttribute('class', 'center hidden')
				}
			}

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to update?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}

	function populateOptionsStatus(chosenTotal=null, chosenSpecific=null, specificEarly = null, specificLate = null){
		let selectAll = document.getElementById('totalAttendance')
		selectAll.innerHTML = ''
		let divSpec = document.getElementById('specificAttendance')
		divSpec.innerHTML = '<span>Need to register <b>specifically</b>: </span>'

		let divLate = document.getElementById('specificLate')
		divLate.innerHTML = '<span><b>Late</b> if:</span>'

		let divEarly = document.getElementById('specificEarly')
		divEarly.innerHTML = '<span><b>Leaft early</b> if:</span>'

		let totalAttendancesNumber = document.getElementById('studentsTable').rows[0].cells.length - 7;

		for (let i = 1; i <= totalAttendancesNumber; ++i){
			let option1 = document.createElement('option')
			option1.setAttribute('value', i.toString())
			let option_text_all
			if (i === 1) option_text_all = document.createTextNode(i+' attendance')
			else option_text_all = document.createTextNode(i+' attendances')
			option1.appendChild(option_text_all)
			selectAll.appendChild(option1)

			if (chosenTotal === null) {
				if (i === totalAttendancesNumber) option1.selected = true
			} else {
				if (i.toString() === chosenTotal.toString()) option1.selected = true
			}

			// ------
			let option2 = document.createElement('input')
			option2.setAttribute('value', i.toString())
			option2.setAttribute('name', 'specificAttendance')
			option2.setAttribute('type', 'checkbox')
			option2.setAttribute('id', i.toString())
			if (!chosenSpecific)
				option2.checked = true;
			else
			if (chosenSpecific.includes(i.toString())) option2.checked = true;

			divSpec.appendChild(option2)

			let option_text_spec;
			if (i === 1) option_text_spec = document.createTextNode(i+'st attendance')
			else if (i === 2) option_text_spec = document.createTextNode(i+'nd attendance')
			else if (i === 3) option_text_spec = document.createTextNode(i+'rd attendance')
			else option_text_spec = document.createTextNode(i+'th attendance')
			let label = document.createElement('label')
			label.setAttribute('for', i.toString())
			label.style.paddingRight = '10px'
			label.appendChild(option_text_spec)
			divSpec.appendChild(label)


		}

		for (let i = 2; i <= totalAttendancesNumber; ++i){
			let option3 = document.createElement('input')
			option3.setAttribute('value', i.toString())
			option3.setAttribute('name', 'specificEarly')
			option3.setAttribute('type', 'checkbox')
			option3.setAttribute('id', i.toString())
			if (!specificEarly) {
				if (i === totalAttendancesNumber) option3.checked = true;
			}
			else {
				if (specificEarly.includes(i.toString())) option3.checked = true;
			}

			divEarly.appendChild(option3)

			let opt;
			if (i === 2) opt = document.createTextNode(i + 'nd attendance')
			else if (i === 3) opt = document.createTextNode(i + 'rd attendance')
			else opt = document.createTextNode(i + 'th attendance')
			let label1 = document.createElement('label')
			label1.setAttribute('for', i.toString())
			label1.style.paddingRight = '10px'
			label1.appendChild(opt)
			divEarly.appendChild(label1)
		}

		for (let i = 1; i < totalAttendancesNumber; ++i) {
			let option4 = document.createElement('input')
			option4.setAttribute('value', i.toString())
			option4.setAttribute('name', 'specificLate')
			option4.setAttribute('type', 'checkbox')
			option4.setAttribute('id', i.toString())
			if (!specificLate) {
				if (i === 1) option4.checked = true;
			}
			else {
				if (specificLate.includes(i.toString())) option4.checked = true;
			}

			divLate.appendChild(option4)

			let opt2;
			if (i === 1) opt2 = document.createTextNode(i + 'st attendance')
			else if (i === 2) opt2 = document.createTextNode(i + 'nd attendance')
			else if (i === 3) opt2 = document.createTextNode(i + 'rd attendance')
			else opt2 = document.createTextNode(i + 'th attendance')
			let label2 = document.createElement('label')
			label2.setAttribute('for', i.toString())
			label2.style.paddingRight = '10px'
			label2.appendChild(opt2)
			divLate.appendChild(label2)
		}
	}

	function getStudentStatus(callback){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					callback(JSON.parse(this.responseText))
				} else {
					console.log("Error getStudentStatus:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/getStudentStatus?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp.send();
	}

	var fixedFingerprintWeight = {
		languages : 2,
		colorDepth : 4,
		deviceMemory : 4,
		hardwareConcurrency : 4,
		screenResolution : 2,
		availableScreenResolution : 2,
		sessionStorage : 1,
		localStorage : 1,
		platform : 3,
		plugins : 1,
		pixelDepth: 4,
		adBlock: 4,
		fonts : 3,
		audio : 4,
		gpu : 5,
		useragent: 2,
		ip : 3
	}

	var ind_default = {
		languages : 2,
		colorDepth : 4,
		deviceMemory : 4,
		hardwareConcurrency : 4,
		screenResolution : 2,
		availableScreenResolution : 2,
		sessionStorage : 1,
		localStorage : 1,
		platform : 3,
		plugins : 1,
		pixelDepth: 4,
		adBlock: 4,
		fonts : 3,
		audio : 4,
		gpu : 5,
		useragent: 2,
		ip : 3
	}



	function updatefixedFingerprintWeight_after(){
		let xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if(this.readyState === 4) {
				if(this.status === 200) {
					let ind = ['useragent', 'ip', 'languages', 'colorDepth', 'deviceMemory', 'hardwareConcurrency', 'screenResolution', 'availableScreenResolution', 'sessionStorage', 'localStorage', 'platform', 'plugins', 'fonts', 'audio', 'gpu', 'adBlock', 'pixelDepth']
					let new_ind = JSON.parse(this.responseText);
					if (new_ind !== null) {
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = new_ind[i];
							document.getElementById(i).value = fixedFingerprintWeight[i];
						})
					} else {
						ind.forEach(function(i){
							fixedFingerprintWeight[i] = ind_default[i];
							document.getElementById(i).value = fixedFingerprintWeight[i];
						})
					}
					// reload pages
					if (document.getElementById('showStudentsHistory').style.display !== 'none'){
						loadStudentsFP('/api/getattendancefp', document.getElementById("currentClass").innerText, null)
					} else if (document.getElementById('studentsFP').style.display !== 'none') {
						getAllLocation('/api/getAllLocationData?cl=' + document.getElementById('currentClass').innerText + '&c=' + courseID + '&s=' + currentShift, document.getElementById('currentStudent').innerText, false)
					}
				} else {
					console.log("Error getStudentStatus:", this.status);
				}
			}
		};
		xhttp.open("GET", '/api/getfixedFingerprintWeight?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
		xhttp.send();
	}

	function getFixedWeight(callback){
		let div = document.getElementById('configWeightDiv')

		if (div.classList.contains('hidden')) {
			div.setAttribute('class', 'center')

			let xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if(this.readyState === 4) {
					if(this.status === 200) {
						let ind = ['useragent', 'ip', 'languages', 'colorDepth', 'deviceMemory', 'hardwareConcurrency', 'screenResolution', 'availableScreenResolution', 'sessionStorage', 'localStorage', 'platform', 'plugins', 'fonts', 'audio', 'gpu', 'adBlock', 'pixelDepth']
						let new_ind = JSON.parse(this.responseText);
						if (new_ind !== null) {
							ind.forEach(function(i){
								fixedFingerprintWeight[i] = new_ind[i];
								document.getElementById(i).value = fixedFingerprintWeight[i]
							})
						} else {
							ind.forEach(function(i){
								fixedFingerprintWeight[i] = ind_default[i];
							})
						}
						if (callback) callback();
					} else {
						console.log("Error getFixedWeight:", this.status);
					}
				}
			};
			xhttp.open("GET", '/api/getfixedFingerprintWeight?c='+courseID+'&s='+currentShift+'&cl='+document.getElementById('currentClass').innerText, true);
			xhttp.send();
		} else {
			div.setAttribute('class', 'center hidden')
		}
	}

	function displayEditConfidence(){
		let div = document.getElementById('editConfidenceDiv')
		if (div.classList.contains('hidden')) div.setAttribute('class', 'center')
		else div.setAttribute('class', 'center hidden')

		getConfidenceWeight();
	}

	function displayEditThresh(){
		let div = document.getElementById('editThreshDiv')
		if (div.classList.contains('hidden')) div.setAttribute('class', 'center')
		else div.setAttribute('class', 'center hidden')

		//getConfidenceWeight();
	}

	function updateConfidence(){
		let formEl = document.getElementById("editConfidence");
		if(!formEl.checkValidity()) {
			formEl.reportValidity();
			return;
		}
		let data = new FormData(formEl);
		let o = {};
		for(let e of data) {
			if (e[0] === 'type_update') o[e[0]] = e[1];
			else
				o[e[0]] = parseInt(e[1]);
		}

		o.courseID = courseID;
		o.shiftID = currentShift;
		o.classNumber = document.getElementById('currentClass').innerText;

		let json_string = JSON.stringify(o);

		let divOver = document.createElement("div");
		divOver.className += "overlay";
		document.body.appendChild(divOver);

		let div = document.createElement("div");
		div.classList.add("confirm");

		let spanCancel = document.createElement("span");
		spanCancel.classList.add("cancelbtn");
		spanCancel.onclick = function() {
			document.getElementById('fp_gps_percent').value = confidenceWeight['gps']*100
			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanCancel.innerText = "Cancel";

		let spanConfirm = document.createElement("span");
		spanConfirm.classList.add("confirmbtn");
		spanConfirm.onclick = function() {

			let xhttp = new XMLHttpRequest();
			let url = "/api/updateConfidenceWeight";
			xhttp.onreadystatechange = function () {
				if (this.readyState === 4 && this.status === 200) {
					updatefixedFingerprintWeight_after();
					document.getElementById('editConfidenceDiv').setAttribute('class', 'center hidden')
				}
			}

			xhttp.open("POST", url, true);
			xhttp.send(json_string);

			this.parentElement.style.display='none';
			while (document.getElementsByClassName('overlay')[0]) {
				document.getElementsByClassName('overlay')[0].remove();
			}
		};
		spanConfirm.innerText = "Confirm";

		div.innerText = "Are you sure you want to update?\n\n";

		document.body.appendChild(div);
		div.appendChild(spanCancel);
		div.appendChild(spanConfirm);
	}


	function defaultConfidence(callback){
		document.getElementById('fp_gps_percent').value = 50
		callback()
	}

	function cancelConfidence(){
		document.getElementById('fp_gps_percent').value = confidenceWeight['gps']*100
	}

	function displayLogos(el){
		el.children[0].style.display = '';
		el.children[1].style.display = 'none'; //square
	}

	function hideLogos(el){
		el.children[0].style.display = 'none';
		el.children[1].style.display = ''; //square
	}

	function goBackToSwitchView(){
		switchView(1);
		loadStudents("/api/getattendancehistory?rid="+currentAttendanceID, document.getElementById("currentClass").innerText);
	}

	document.onkeypress = function (event) {
		if (event.code === 'NumpadAdd' || event.code === 'BracketLeft') {
			let d = new Date();
			console.log('begining counting...')
			localStorage.setItem('click_counter', '0')
			localStorage.setItem('duration', d.getTime().toString())
		} else if (event.code === 'NumpadSubtract' || event.code === 'Slash') {
			let d = new Date();
			console.log('finished counting...')
			console.log('clicks: ', localStorage.getItem('click_counter'))
			console.log('duration: ', (Number(d.getTime())-Number(localStorage.getItem('duration')))/1000)
		}
	}

	document.onmousedown = function(event) {
		if (event.button === 0)
			localStorage.setItem('click_counter', (parseInt(localStorage.getItem('click_counter'))+1).toString())
	}

</script>